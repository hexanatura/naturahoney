<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Dashboard</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
      :root {
    --primary: #0f172a;
    --secondary: #ffffff;
    --accent: #22c55e;
    --accent-soft: #bbf7d0;
    --dark: #020617;
    --light: #f8fafc;
    --gray: #64748b;
    --muted: #94a3b8;
    --success: #16a34a;
    --danger: #dc2626;
    --border: rgba(15, 23, 42, 0.12);
    --radius-lg: 22px;
    --radius-md: 16px;
    --radius-sm: 12px;
    --shadow-lg: 0 18px 45px rgba(15, 23, 42, 0.25);
    --shadow-md: 0 12px 30px rgba(15, 23, 42, 0.18);
    --shadow-sm: 0 8px 20px rgba(15, 23, 42, 0.15);
    --grad-dark: linear-gradient(135deg, #0f172a, #1e293b, #0f172a);

}

*,
*::before,
*::after {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
}

body {
    background: linear-gradient(135deg, #f9fafb, #e5f3ff, #fefce8);
    color: var(--dark);
    font-family: 'Inter', sans-serif;
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
}

.dashboard-container {
    display: grid;
    grid-template-columns: 270px 1fr;
    align-items: flex-start;
    min-height: 100vh;
    width: 100%;
}

.sidebar {
    background: #fff;
    display: flex;
    flex-direction: column;
    padding: 20px;
    position: sticky;
    top: 0;
    height: 100vh;
    overflow-y: auto;
    border-right: 1px solid var(--border);
    box-shadow: var(--shadow-md);
    z-index: 900;
    transform: translateX(0);
    transition: transform 0.3s ease;
}

.sidebar-section {
    background: #ffffff;
    border-radius: var(--radius-lg);
    margin-bottom: 18px;
    padding: 18px 18px 16px;
    display: flex;
    flex-direction: column;
    transition: transform 0.25s ease, box-shadow 0.25s ease;
    box-shadow: var(--shadow-sm);
    border: 1px solid var(--border);
}

.sidebar-section:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-lg);
}

.branding {
    height: auto;
    justify-content: center;
    align-items: center;
    text-align: center;
    gap: 4px;
}

.brand-logo {
    font-size: 1.9rem;
    margin-bottom: 4px;
    color: var(--accent);
}

.brand-name {
    font-family: 'Outfit', sans-serif;
    font-size: 1.4rem;
    font-weight: 700;
    letter-spacing: 0.04em;
}

.brand-tagline {
    font-size: 0.8rem;
    color: var(--muted);
}

.menu {
    flex: 1;
}

.menu-item {
    display: flex;
    align-items: center;
    padding: 8px 10px;
    margin-bottom: 4px;
    border-radius: var(--radius-sm);
    cursor: pointer;
    transition: background 0.2s ease, transform 0.15s ease;
}

.menu-item:hover {
    background: rgba(15, 23, 42, 0.04);
    transform: translateY(-1px);
}

.menu-item.active {
    background: linear-gradient(120deg, rgba(34, 197, 94, 0.12), rgba(59, 130, 246, 0.12));
    border: 1px solid rgba(34, 197, 94, 0.4);
    box-shadow: var(--shadow-sm);
}

.menu-icon {
    margin-right: 8px;
    font-size: 1rem;
    width: 22px;
    text-align: center;
    color: var(--accent);
}

.menu-text {
    font-weight: 500;
    font-size: 0.94rem;
    color: var(--primary);
}

.performance-metrics {
    display: flex;
    flex-direction: column;
    gap: 0;
}

.metric-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 8px;
    border-bottom: 1px solid rgba(148, 163, 184, 0.24);
    transition: background 0.2s ease, transform 0.15s ease;
}

.metric-row:last-child {
    border-bottom: none;
}

.metric-row:hover {
    background: rgba(248, 250, 252, 0.9);
    border-radius: 12px;
    transform: translateY(-1px);
}

.metric-info {
    display: flex;
    flex-direction: column;
}

.metric-label {
    font-size: 0.8rem;
    color: var(--muted);
    margin-bottom: 2px;
}

.metric-value {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--primary);
}

.metric-change {
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    gap: 4px;
    padding: 4px 8px;
    border-radius: 999px;
    background: rgba(34, 197, 94, 0.08);
    color: var(--success);
}

.metric-change.negative {
    background: rgba(239, 68, 68, 0.08);
    color: var(--danger);
}

.sidebar-footer {
    text-align: center;
    opacity: 0.9;
    font-size: 0.74rem;
    margin-top: 10px;
}

.sidebar-footer .dev-text {
    color: rgba(15, 23, 42, 0.7);
    line-height: 1.3;
}

.sidebar-footer .dev-logo img {
    width: 40px;
    height: auto;
    opacity: 0.95;
    margin-bottom: 4px;
}

.main-content {
    overflow-y: visible;
    height: auto;
    margin-top: 20px;
    margin-bottom: 0;
    padding: 20px 20px 0 20px;
    width: 100%;
}

#dashboardBody {
    width: 100%;
}

#dynamicPage {
    padding-right: 20px;
    width: 100%;
    background: transparent;
    min-height: calc(100vh - 40px);
}

#dynamicPage.promo-page {
    background: #ffffff;
}

.top-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 25px;
    padding: 10px 12px 0;
    flex-wrap: wrap;
    gap: 16px;
    position: relative;
}

.search-bar {
    position: relative;
    width: 100%;
    max-width: 600px;
    flex: 1;
}

.search-bar i {
    position: absolute;
    left: 14px;
    top: 50%;
    transform: translateY(-50%);
    color: var(--gray);
    z-index: 1;
    font-size: 0.9rem;
}

.search-bar input {
    width: 100%;
    padding: 10px 14px 10px 38px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.6);
    background: #ffffff;
    box-shadow: var(--shadow-sm);
    font-family: 'Inter', sans-serif;
    font-size: 0.9rem;
    transition: all 0.2s ease;
    color: var(--dark);
}

.search-bar input:focus {
    outline: none;
    box-shadow: var(--shadow-md);
    transform: translateY(-1px);
    border-color: rgba(34, 197, 94, 0.8);
}

.search-bar input::placeholder {
    color: var(--muted);
}

.header-icons {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-right: 4px;
    flex-wrap: wrap;
}

.icon-btn {
    width: 36px;
    height: 36px;
    background: #ffffff;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    border: 1px solid rgba(148, 163, 184, 0.7);
    text-decoration: none;
    color: var(--primary);
    font-size: 0.95rem;
    box-shadow: var(--shadow-sm);
    transition: 0.15s ease;
}

.icon-btn:hover {
    background: rgba(34, 197, 94, 0.08);
    transform: translateY(-1px) scale(1.02);
    border-color: rgba(34, 197, 94, 0.8);
}

.admin-profile {
    position: relative;
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 7px 16px;
    border-radius: 999px;
    box-shadow: var(--shadow-lg);
    background: var(--grad-dark);
    border: 1px solid rgba(255,255,255,0.25);
    cursor: pointer;
    transition: all 0.2s ease;
    color: #e5e7eb;
    z-index: 1000 !important;

}

.admin-profile:hover {
    transform: translateY(-1px);
    box-shadow: 0 18px 45px rgba(15, 23, 42, 0.8);
}

.profile-info {
    display: flex;
    flex-direction: column;
    align-items: flex-end;
}

.profile-name {
    font-weight: 600;
    font-size: 0.93rem;
}

.profile-role {
    font-size: 0.78rem;
    color: #cbd5f5;
}

.profile-avatar {
    width: 38px;
    height: 38px;
    border-radius: 999px;
    background: radial-gradient(circle at top left, #22c55e, #16a34a, #166534);
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 0.95rem;
    border: 1px solid rgba(255, 255, 255, 0.8);
}

.profile-dropdown {
    color: #cbd5f5;
    font-size: 0.78rem;
    transition: transform 0.2s ease;
}

.admin-profile:hover .profile-dropdown {
    transform: translateY(1px);
}

@media (max-width: 992px) {
    .top-header {
        gap: 14px !important;
        padding-top: 26px !important;
        margin-bottom: 14px !important;
    }

    .search-bar {
        margin-bottom: 6px !important;
    }

    .header-icons {
        gap: 10px !important;
        margin-bottom: 6px !important;
    }

    .admin-profile {
        margin-top: 4px !important;
    }
}

@media (max-width: 576px) {
    .top-header {
        gap: 16px !important;
    }

    .header-icons {
        gap: 10px !important;
    }

    .admin-profile {
        margin-top: 6px !important;
    }
}


#profileMenu {
    position: absolute;
    right: 0;
    top: 48px;
    border-radius: 12px;
    box-shadow: 0 18px 45px rgba(15, 23, 42, 0.9);
       background: var(--grad-dark);
    border: 1px solid rgba(255,255,255,0.25);
    padding: 6px 0;
    min-width: 150px;
    display: none;
    z-index: 1001 !important;
}

#profileMenu .menu-item-btn {
    padding: 8px 14px;
    font-size: 0.85rem;
    cursor: pointer;
    color: #e5e7eb;
    display: flex;
    align-items: center;
    gap: 8px;
}

#profileMenu .menu-item-btn:hover {
    background: rgba(15, 23, 42, 0.9);
}

.welcome-calendar-section {
    display: grid;
    grid-template-columns: 2.1fr 1fr;
    gap: 22px;
    margin-bottom: 26px;
}

.welcome-section {
    background: #ffffff;
    border-radius: var(--radius-lg);
    padding: 20px 20px 18px;
    display: flex;
    flex-direction: column;
    transition: all 0.25s ease;
    box-shadow: var(--shadow-md);
    border: 1px solid var(--border);
    height: auto;
    width: 100%;
}

.welcome-section:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-lg);
}

.welcome-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 16px;
    flex-wrap: wrap;
    gap: 12px;
    width: 100%;
}

.welcome-title {
    font-family: 'Outfit', sans-serif;
    font-size: clamp(1.45rem, 4vw, 1.8rem);
    font-weight: 700;
    color: var(--primary);
    line-height: 1.15;
}

.welcome-subtitle {
    font-size: clamp(0.85rem, 2.5vw, 0.95rem);
    color: var(--muted);
    margin-top: 4px;
}

.welcome-content {
    display: flex;
    flex-direction: column;
    width: 100%;
}

.welcome-stats {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 12px;
    width: 100%;
    margin-bottom: 20px;
}

.welcome-stat {
    display: flex;
    flex-direction: column;
    padding: 12px 11px;
    background: #f9fafb;
    border-radius: 14px;
    text-align: center;
    min-width: 0;
    transition: all 0.2s ease;
    border: 1px solid rgba(148, 163, 184, 0.45);
}

.welcome-stat:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
    background: #ffffff;
}

.stat-number {
    font-size: clamp(1.25rem, 3vw, 1.65rem);
    font-weight: 700;
    color: var(--primary);
    margin-bottom: 4px;
    line-height: 1.15;
}

.stat-text {
    font-size: clamp(0.78rem, 2vw, 0.88rem);
    color: var(--muted);
    line-height: 1.3;
}

.date-widget {
    display: flex;
    align-items: center;
    padding: 7px 14px 7px 7px;
    border-radius: 999px;
    width: fit-content;
    gap: 10px;
    flex-shrink: 0;
    color: #e5e7eb;
     background: var(--grad-dark);
    border: none;
    box-shadow: 0 18px 50px rgba(15, 23, 42, 0.8);
}

.day-circle {
    width: 44px;
    height: 44px;
    border-radius: 999px;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-sm);
    flex-shrink: 0;
      background: var(--grad-dark);
    border: 1px solid rgba(255, 255, 255, 0.25);
}

.day-number {
    color: #f9fafb;
    font-size: 1.1rem;
    font-weight: 600;
}

.date-info {
    display: flex;
    flex-direction: column;
    line-height: 1.2;
}

.day-name,
.month-name {
    color: #e5e7eb;
    font-size: 0.8rem;
    font-weight: 500;
}

.calendar-section {
    background: #ffffff;
    border-radius: var(--radius-lg);
    padding: 18px 18px 16px;
    box-shadow: var(--shadow-md);
    display: flex;
    flex-direction: column;
    height: 100%;
    border: 1px solid var(--border);
}

.calendar-title {
    font-family: 'Outfit', sans-serif;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 14px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
}

.calendar-title button {
    background: rgba(34, 197, 94, 0.12);
    border-radius: 999px;
    border: 1px solid rgba(34, 197, 94, 0.6);
    padding: 5px 11px;
    font-size: 0.8rem;
    cursor: pointer;
    color: var(--primary);
    display: flex;
    align-items: center;
    gap: 5px;
}

.calendar-title button:hover {
    background: rgba(34, 197, 94, 0.18);
}

.calendar-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
    flex-wrap: wrap;
    gap: 8px;
}

.calendar-month {
    font-weight: 600;
    font-size: 1rem;
}

.calendar-nav {
    display: flex;
    gap: 8px;
}

.calendar-nav button {
    background: #f9fafb;
    border: 1px solid rgba(148, 163, 184, 0.8);
    cursor: pointer;
    font-size: 0.85rem;
    color: var(--gray);
    padding: 4px 6px;
    border-radius: 999px;
    transition: all 0.15s ease;
}

.calendar-nav button:hover {
    background: rgba(34, 197, 94, 0.16);
    color: var(--primary);
}

.calendar-weekdays {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    text-align: center;
    margin-bottom: 6px;
    font-weight: 500;
    font-size: 0.8rem;
    color: var(--muted);
}

.calendar-days {
    display: grid;
    grid-template-columns: repeat(7, 1fr);
    gap: 5px;
    flex: 1;
}

.calendar-day {
    height: 30px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 10px;
    font-size: 0.8rem;
    cursor: pointer;
    transition: background 0.15s ease, color 0.15s ease, transform 0.1s ease;
}

.calendar-day:hover {
    background: rgba(148, 163, 184, 0.18);
}

.calendar-day.other-month {
    color: #cbd5f5;
    opacity: 0.6;
}

.calendar-day.today {
    background: rgba(34, 197, 94, 0.15);
    font-weight: 600;
    border: 1px solid rgba(34, 197, 94, 0.8);
}

.calendar-day.selected {
    background: radial-gradient(circle at top left, #22c55e, #16a34a);
    color: white;
    border: none;
}

.recent-orders-section {
    margin-bottom: 16px;
    width: 100%;
}

.section-title {
    font-family: 'Outfit', sans-serif;
    font-size: 1.2rem;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 12px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
    width: 100%;
}

.orders-list {
    display: flex;
    flex-direction: row;
    gap: 10px;
    overflow-x: auto;
    overflow-y: hidden;
    padding-bottom: 4px;
    white-space: nowrap;
    scroll-behavior: smooth;
    width: 100%;
    min-height: 120px;
}

.order-item {
    background: #ffffff;
    border-radius: 16px;
    padding: 10px 11px;
    box-shadow: var(--shadow-sm);
    transition: all 0.2s ease;
    width: 190px;
    min-width: 190px;
    flex: 0 0 190px;
    display: flex;
    flex-direction: column;
    margin-bottom: 8px;
    gap: 6px;
    border: 1px solid rgba(148, 163, 184, 0.55);
}

.order-item:hover:not(.order-item-empty) {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    background: #f9fafb;
}

.order-item-empty {
    opacity: 0.9;
}

.order-info {
    display: flex;
    align-items: center;
    gap: 10px;
}

.order-icon {
    width: 34px;
    height: 34px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.95rem;
    background: radial-gradient(circle at top left, rgba(34, 197, 94, 0.5), rgba(15, 23, 42, 0.9));
    color: #f9fafb;
}

.order-details {
    display: flex;
    flex-direction: column;
}

.order-id {
    font-weight: 600;
    font-size: 0.9rem;
}

.order-amount {
    font-size: 0.8rem;
    color: var(--muted);
}

.order-status {
    padding: 4px 10px;
    border-radius: 999px;
    font-size: 0.72rem;
    font-weight: 500;
    align-self: flex-start;
}

.status-pending { background-color: #fff7d6; color: #854d0e; }
.status-processing { background-color: #e0f2fe; color: #075985; }
.status-shipped { background-color: #dbeafe; color: #1d4ed8; }
.status-delivered { background-color: #dcfce7; color: #166534; }
.status-confirmed { background: rgba(59,130,246,0.08); color:#1d4ed8; border:1px solid rgba(59,130,246,0.25); }
.status-cancelled { background: rgba(239,68,68,0.08); color:#b91c1c; border:1px solid rgba(239,68,68,0.25); }

.reviews-activities-section {
    margin-bottom: 26px;
}

.reviews-section {
    background: #ffffff;
    border-radius: var(--radius-lg);
    padding: 20px 20px 16px;
    box-shadow: var(--shadow-md);
    display: flex;
    flex-direction: column;
    min-height: 320px;
    border: 1px solid var(--border);
    width: 100%;
}

.menu-count {
    background: #dc2626;
    color: #fff;
    padding: 1px 6px;
    border-radius: 999px;
    font-size: 0.72rem;
    font-weight: 600;
    margin-left: auto;
    display: none; /* hidden when empty */
}


.reviews-title {
    font-family: 'Outfit', sans-serif;
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--primary);
    margin-bottom: 16px;
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 10px;
}

.review-actions {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
}

.review-action-btn {
    padding: 6px 12px;
    border-radius: 999px;
    border: 1px solid rgba(148, 163, 184, 0.7);
    background: #f9fafb;
    font-size: 0.78rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 6px;
    transition: all 0.15s;
}

.review-action-btn.primary {
    background: radial-gradient(circle at top left, #22c55e, #16a34a);
    border-color: rgba(22, 163, 74, 0.9);
    color: #f9fafb;
}

.review-action-btn.danger {
    background: rgba(248, 113, 113, 0.12);
    border-color: rgba(248, 113, 113, 0.7);
    color: #b91c1c;
}

.review-action-btn:hover {
    transform: translateY(-1px);
    box-shadow: var(--shadow-sm);
}

.reviews-list {
    display: flex;
    flex-direction: column;
    gap: 12px;
    overflow-y: auto;
    flex: 1;
    padding-right: 4px;
}

.review-item {
    display: flex;
    flex-direction: column;
    gap: 8px;
    padding: 12px;
    border-radius: 14px;
    transition: all 0.2s ease;
    background: #f9fafb;
    border: 1px solid rgba(148, 163, 184, 0.55);
}

.review-item:hover {
    background: #ffffff;
    box-shadow: var(--shadow-sm);
}

.review-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
}

.reviewer-info {
    display: flex;
    align-items: center;
    gap: 9px;
}

.reviewer-avatar {
    width: 34px;
    height: 34px;
    border-radius: 999px;
    background: rgba(15, 23, 42, 0.06);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.85rem;
    color: var(--accent);
}

.reviewer-details {
    display: flex;
    flex-direction: column;
}

.reviewer-name {
    font-weight: 600;
    font-size: 0.9rem;
}

.review-date {
    font-size: 0.78rem;
    color: var(--muted);
}

.review-rating {
    display: flex;
    gap: 3px;
}

.star {
    color: #facc15;
}

.review-content {
    font-size: 0.86rem;
    line-height: 1.5;
    color: var(--dark);
}

#loginModal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    backdrop-filter: blur(12px);
    background: rgba(15, 23, 42, 0.45);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 2000;
}

.login-card {
    background: #020617;
    padding: 22px 20px 20px;
    border-radius: 18px;
    width: 320px;
    display: flex;
    flex-direction: column;
    gap: 10px;
    box-shadow: 0 24px 70px rgba(15, 23, 42, 0.95);
    border: 1px solid rgba(148, 163, 184, 0.7);
    color: #e5e7eb;
}

.login-title {
    font-family: 'Outfit', sans-serif;
    font-size: 1.2rem;
    font-weight: 600;
    margin-bottom: 4px;
}

.login-subtitle {
    font-size: 0.8rem;
    color: #9ca3af;
    margin-bottom: 10px;
}

.login-input {
    padding: 9px 10px;
    border-radius: 10px;
    border: 1px solid rgba(148, 163, 184, 0.8);
    background: #020617;
    color: #e5e7eb;
    font-size: 0.84rem;
}

.login-input::placeholder {
    color: #9ca3af;
}

.login-input:focus {
    outline: none;
    border-color: rgba(34, 197, 94, 0.9);
    box-shadow: 0 0 0 1px rgba(34, 197, 94, 0.6);
}

#loginSubmit {
    padding: 9px 10px;
    border: none;
    border-radius: 999px;
    background: radial-gradient(circle at top left, #22c55e, #16a34a);
    color: #f9fafb;
    font-weight: 500;
    cursor: pointer;
    margin-top: 4px;
    font-size: 0.9rem;
}

#loginSubmit:hover {
    box-shadow: 0 18px 45px rgba(22, 163, 74, 0.95);
    transform: translateY(-1px);
}

.login-error {
    font-size: 0.8rem;
    color: #fca5a5;
    min-height: 18px;
}

::-webkit-scrollbar {
    width: 7px;
    height: 7px;
}

::-webkit-scrollbar-track {
    background: rgba(15, 23, 42, 0.04);
}

::-webkit-scrollbar-thumb {
    background: rgba(148, 163, 184, 0.8);
    border-radius: 999px;
}

::-webkit-scrollbar-thumb:hover {
    background: rgba(107, 114, 128, 1);
}

.sidebar-overlay {
    display: none;
}

.sidebar-overlay.active {
    display: block;
}

.mobile-menu-btn {
    display: none;
    position: fixed;
    top: 20px;
    left: 20px;
    z-index: 1300;
    background: var(--primary);
    border: 1px solid rgba(148, 163, 184, 0.8);
    border-radius: 999px;
    width: 48px;
    height: 48px;
    box-shadow: var(--shadow-lg);
    cursor: pointer;
    font-size: 1.1rem;
    color: #e5e7eb;
    align-items: center;
    justify-content: center;
}

.fade-in {
    animation: fadeIn 0.45s ease forwards;
}

.delay-1 { animation-delay: 0.08s; }
.delay-2 { animation-delay: 0.16s; }
.delay-3 { animation-delay: 0.24s; }

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(18px); }
    to { opacity: 1; transform: translateY(0); }
}

@media (max-width: 1200px) {
    .welcome-stats {
        grid-template-columns: repeat(2, 1fr);
    }

    .welcome-calendar-section {
        grid-template-columns: 1fr;
    }

    .dashboard-container {
        grid-template-columns: 240px 1fr;
    }
}

@media (max-width: 992px) {
    .dashboard-container {
        grid-template-columns: 1fr;
    }

    .sidebar {
        position: fixed;
        top: 0;
        left: 0;
        width: 260px;
        height: 100vh;
        transform: translateX(-100%);
        z-index: 1200;
        box-shadow: var(--shadow-lg);
    }

    .sidebar.active {
        transform: translateX(0);
    }

    .sidebar-overlay {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(15, 23, 42, 0.45);
        z-index: 1100;
    }

    .sidebar-overlay.active {
        display: block;
    }

    .mobile-menu-btn {
        display: flex;
    }

   .top-header {
        padding-top: 20px;
        margin-bottom: 10px;
        flex-direction: column;
        gap: 8px;
        align-items: flex-start;
    }

    .search-bar {
        margin-bottom: 0;
    }

    .header-icons {
        margin: 0;
        gap: 10px;
    }

    .admin-profile {
        margin-top: 0;
        align-self: flex-end;
    }

    .main-content {
        padding-top: 20px;
        padding-right: 16px;
        padding-left: 16px;
    }
}

@media (max-width: 768px) {
    .welcome-stats {
        grid-template-columns: 1fr;
    }

    .welcome-stat {
        min-width: 100%;
    }

    .orders-list {
        max-width: 100%;
    }

    .order-item {
        min-width: 170px;
        flex: 0 0 170px;
    }

    .header-icons {
        gap: 9px;
    }

    .icon-btn {
        width: 34px;
        height: 34px;
    }

    .reviews-section,
    .welcome-section,
    .calendar-section {
        padding: 16px 14px;
    }
}

@media (max-width: 576px) {
    .main-content {
        padding: 14px;
    }

    .calendar-day {
        height: 26px;
        font-size: 0.76rem;
    }

    .review-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px;
    }

    .review-rating {
        align-self: flex-start;
    }

    .welcome-calendar-section,
    .reviews-activities-section {
        margin-bottom: 18px;
    }

    .admin-profile {
        padding: 6px 12px;
    }

    .profile-avatar {
        width: 32px;
        height: 32px;
    }

    .login-card {
        width: 88%;
    }
}

@media (max-width: 480px) {
    .mobile-menu-btn {
        top: 10px;
        left: 10px;
        width: 40px;
        height: 40px;
        font-size: 0.9rem;
    }

    .main-content {
        padding-top: 60px;
    }

    .order-item {
        min-width: 155px;
        flex: 0 0 155px;
    }

    .top-header {
        gap: 12px;
    }
}

    </style>
</head>
<body>
    <button class="mobile-menu-btn" id="mobileMenuBtn">
        <i class="fas fa-bars"></i>
    </button>

    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <div class="dashboard-container">
        <div class="sidebar" id="sidebar">
            <div class="sidebar-section branding">
                <div class="brand-logo"><i class="fas fa-chart-pie"></i></div>
                <div class="brand-name">Natura Honey</div>
                <div class="brand-tagline">The Taste Of Hundreds</div>
            </div>

            <div class="sidebar-section menu">
                <div class="menu-item active">
                    <div class="menu-icon"><i class="fas fa-home"></i></div>
                    <div class="menu-text">Dashboard</div>
                </div>
                <div class="menu-item" id="menuOrders">
    <div class="menu-icon"><i class="fas fa-shopping-bag"></i></div>
    <div class="menu-text">Orders</div>
    <span class="menu-count" id="countOrders"></span>
</div>

<div class="menu-item" id="menuCustomers">
    <div class="menu-icon"><i class="fas fa-users"></i></div>
    <div class="menu-text">Customers</div>
    <span class="menu-count" id="countCustomers"></span>
</div>

<div class="menu-item" id="menuMessages">
    <div class="menu-icon"><i class="fas fa-envelope"></i></div>
    <div class="menu-text">Messages</div>
    <span class="menu-count" id="countMessages"></span>
</div>

<div class="menu-item" id="menuReviews">
                    <div class="menu-icon"><i class="fas fa-star"></i></div>
                    <div class="menu-text">Reviews</div>
                </div>
            </div>

            <div class="sidebar-section">
                <div class="performance-metrics">
                    <div class="metric-row fade-in">
                        <div class="metric-info">
                            <div class="metric-label">Monthly Revenue</div>
                            <div class="metric-value">₹0.00</div>
                        </div>
                        <div class="metric-change">
                            <i class="fas fa-arrow-up"></i> 0.0%
                        </div>
                    </div>
                    <div class="metric-row fade-in delay-1">
                        <div class="metric-info">
                            <div class="metric-label">Total Customers</div>
                            <div class="metric-value">0</div>
                        </div>
                        <div class="metric-change">
                            <i class="fas fa-arrow-up"></i> 0.0%
                        </div>
                    </div>
                    <div class="metric-row fade-in delay-2">
                        <div class="metric-info">
                            <div class="metric-label">Orders</div>
                            <div class="metric-value">0</div>
                        </div>
                        <div class="metric-change">
                            <i class="fas fa-arrow-up"></i> 0.0%
                        </div>
                    </div>
                    <div class="metric-row fade-in delay-3">
                        <div class="metric-info">
                            <div class="metric-label">Messages</div>
                            <div class="metric-value">0</div>
                        </div>
                        <div class="metric-change">
                            <i class="fas fa-arrow-up"></i> 0.0%
                        </div>
                    </div>
                    <div class="sidebar-footer">
                        <div class="dev-logo">
                            <img src="your-logo.png" alt="Developer Logo">
                        </div>
                        <div class="dev-text">
                            © 2025 Hexa Honey<br>
                            Developed by Hash.studio
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="main-content" id="mainContent">
            <div class="top-header">
                <div class="search-bar">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search orders, customers, analytics...">
                </div>

                <div class="header-icons">
                    <a href="https://yourwebsite.com" target="_blank" class="icon-btn">
                        <i class="fas fa-globe"></i>
                    </a>
                    <button class="icon-btn" onclick="location.reload()">
                        <i class="fas fa-sync"></i>
                    </button>
                    <a href="mailto:yourmail@gmail.com" class="icon-btn">
                        <i class="fas fa-envelope"></i>
                    </a>
                    <a href="https://instagram.com/yourpage" target="_blank" class="icon-btn">
                        <i class="fab fa-instagram"></i>
                    </a>
                    <a href="https://facebook.com/yourpage" target="_blank" class="icon-btn">
                        <i class="fab fa-facebook-f"></i>
                    </a>
                    <a href="https://youtube.com/yourchannel" target="_blank" class="icon-btn">
                        <i class="fab fa-youtube"></i>
                    </a>
                </div>

                <div class="admin-profile" id="adminProfile">
                    <div class="profile-info">
                        <div class="profile-name" id="adminName">Admin User</div>
                        <div class="profile-role">Administrator</div>
                    </div>
                    <div class="profile-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="profile-dropdown">
                        <i class="fas fa-chevron-down"></i>
                    </div>

                    <div id="profileMenu">
                        <div class="menu-item-btn" id="logoutBtn">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Logout</span>
                        </div>
                    </div>
                </div>
            </div>

            <div id="dashboardBody">
                <div class="welcome-calendar-section">
                    <div class="welcome-section fade-in">
                        <div class="welcome-header">
                            <div>
                                <h2 class="welcome-title">Welcome back, Admin</h2>
                                <p class="welcome-subtitle">Here's your business overview for today</p>
                            </div>
                            <div class="date-widget" id="date-widget">
                                <div class="day-circle">
                                    <span class="day-number" id="current-day"></span>
                                </div>
                                <div class="date-info">
                                    <span class="day-name" id="current-day-name"></span>
                                    <span class="month-name" id="current-month-year"></span>
                                </div>
                            </div>
                        </div>

                        <div class="welcome-content">
                            <div class="welcome-stats">
                                <div class="welcome-stat">
                                    <div class="stat-number">₹0.00</div>
                                    <div class="stat-text">Today's Revenue</div>
                                </div>
                                <div class="welcome-stat">
                                    <div class="stat-number">0</div>
                                    <div class="stat-text">Pending Orders</div>
                                </div>
                                <div class="welcome-stat">
                                    <div class="stat-number">0</div>
                                    <div class="stat-text">New Customers</div>
                                </div>
                                <div class="welcome-stat">
                                    <div class="stat-number">0</div>
                                    <div class="stat-text">Messages</div>
                                </div>
                            </div>
                        </div>

                        <div class="recent-orders-section">
                            <div class="section-title">
                                <span>Recent Orders</span>
                            </div>
                            <div class="orders-list" id="dashboardRecentOrders"></div>
                        </div>
                    </div>

                    <div class="calendar-section">
                        <div class="calendar-title">
                            <span>Calendar</span>
                            <button type="button">
                                <i class="fas fa-plus"></i> Add Event
                            </button>
                        </div>

                        <div class="calendar-header">
                            <div class="calendar-month" id="calendar-month">Month 2025</div>
                            <div class="calendar-nav">
                                <button id="prev-month"><i class="fas fa-chevron-left"></i></button>
                                <button id="next-month"><i class="fas fa-chevron-right"></i></button>
                            </div>
                        </div>

                        <div class="calendar-weekdays">
                            <div>Sun</div><div>Mon</div><div>Tue</div><div>Wed</div><div>Thu</div><div>Fri</div><div>Sat</div>
                        </div>
                        <div class="calendar-days" id="calendar-days"></div>
                    </div>
                </div>

                <div class="reviews-activities-section">
                    <div class="reviews-section">
                        <div class="reviews-title">
                            <span>Customer Reviews</span>
                            <div class="review-actions">
                                <button type="button" class="review-action-btn primary" id="publishReviewBtn">
                                    <i class="fas fa-upload"></i> Publish
                                </button>
                                <button type="button" class="review-action-btn danger" id="removeReviewBtn">
                                    <i class="fas fa-trash-alt"></i> Remove
                                </button>
                                <button type="button" class="review-action-btn" id="createReviewBtn">
                                    <i class="fas fa-plus"></i> Create
                                </button>
                            </div>
                        </div>

                        <div class="reviews-list">
                            <div class="review-item">
                                <div class="review-header">
                                    <div class="reviewer-info">
                                        <div class="reviewer-avatar"><i class="fas fa-user"></i></div>
                                        <div class="reviewer-details">
                                            <div class="reviewer-name">Rahul Sharma</div>
                                            <div class="review-date">2 days ago</div>
                                        </div>
                                    </div>
                                    <div class="review-rating">
                                        <i class="fas fa-star star"></i>
                                        <i class="fas fa-star star"></i>
                                        <i class="fas fa-star star"></i>
                                        <i class="fas fa-star star"></i>
                                        <i class="fas fa-star star"></i>
                                    </div>
                                </div>
                                <div class="review-content">
                                    Excellent service and fast delivery. The product quality exceeded my expectations. Will order again!
                                </div>
                            </div>

                            <div class="review-item">
                                <div class="review-header">
                                    <div class="reviewer-info">
                                        <div class="reviewer-avatar"><i class="fas fa-user"></i></div>
                                        <div class="reviewer-details">
                                            <div class="reviewer-name">Priya Patel</div>
                                            <div class="review-date">5 days ago</div>
                                        </div>
                                    </div>
                                    <div class="review-rating">
                                        <i class="fas fa-star star"></i>
                                        <i class="fas fa-star star"></i>
                                        <i class="fas fa-star star"></i>
                                        <i class="fas fa-star star"></i>
                                        <i class="far fa-star"></i>
                                    </div>
                                </div>
                                <div class="review-content">
                                    Good product overall, but the packaging could be improved.
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div id="dynamicPage"></div>
        </div>
    </div>

    <!-- LOGIN MODAL (AUTH REQUIRED) -->
    <div id="loginModal">
        <div class="login-card">
            <div class="login-title">Admin Login</div>
            <div class="login-subtitle">Access to this dashboard is restricted to administrators only.</div>

            <input id="loginEmail" type="email" class="login-input" placeholder="Email">
            <input id="loginPassword" type="password" class="login-input" placeholder="Password">

            <div class="login-error" id="loginError"></div>

            <button id="loginSubmit">Login</button>
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-auth.js"></script>

<script>
    // ------------------------------
    // FIREBASE INIT
    // ------------------------------
    var firebaseConfig = {
        apiKey: "AIzaSyDuF6bdqprddsE871GuOablXPYqXI_HJxc",
        authDomain: "hexahoney-96aed.firebaseapp.com",
        projectId: "hexahoney-96aed",
        storageBucket: "hexahoney-96aed.firebasestorage.app",
        messagingSenderId: "700458850837",
        appId: "1:700458850837:web:0eb4fca98a5f4acc2d0c1c",
        measurementId: "G-MQGKK9709H"
    };

    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();
    
    // ADD TO TOP OF DASHBOARD SCRIPT (after Firebase init)
class QueryManager {
  constructor() { this.cache = new Map(); this.pending = new Map(); }
  async getCached(collection, queryFn, cacheKey, ttl = 60000) {
    const now = Date.now();
    const cached = this.cache.get(cacheKey);
    if (cached && (now - cached.timestamp) < ttl) return cached.data;
    if (this.pending.has(cacheKey)) return this.pending.get(cacheKey);
    
    const promise = queryFn();
    this.pending.set(cacheKey, promise);
    try {
      const data = await promise;
      this.cache.set(cacheKey, { data, timestamp: now });
      return data;
    } finally { this.pending.delete(cacheKey); }
  }
  clearCache() { this.cache.clear(); this.pending.clear(); }
}

class CleanupManager {
  constructor() { this.cleanups = new Set(); }
  add(cleanupFn) { this.cleanups.add(cleanupFn); }
  cleanup() { this.cleanups.forEach(fn => fn()); this.cleanups.clear(); }
}

const queryManager = new QueryManager();
const cleanupManager = new CleanupManager();

profileMenu.addEventListener("click", (e) => {
    e.stopPropagation();
});

    // ------------------------------
    // UTILS
    // ------------------------------
    function getDayRange(date) {
        const d = new Date(date);
        const yyyy = d.getFullYear();
        const mm = d.getMonth();
        const dd = d.getDate();
        const start = new Date(yyyy, mm, dd, 0, 0, 0, 0);
        const end   = new Date(yyyy, mm, dd, 23, 59, 59, 999);
        return { start, end };
    }

    function getMonthRange(year, month) {
        const start = new Date(year, month, 1, 0, 0, 0);
        const end   = new Date(year, month + 1, 0, 23, 59, 59);
        return { start, end };
    }

    function calcPercentChange(current, previous) {
        if (previous === 0) return current > 0 ? 100 : 0;
        return ((current - previous) / previous) * 100;
    }

    function statusClass(s) {
        const map = {
            pending: "status-pending",
            confirmed: "status-confirmed",
            shipped: "status-shipped",
            delivered: "status-delivered",
            cancelled: "status-cancelled",
            processing: "status-processing"
        };
        return map[s] || "status-pending";
    }

    // ------------------------------
    // GLOBAL DATE RANGES
    // ------------------------------
    const now = new Date();
    const CUR = getMonthRange(now.getFullYear(), now.getMonth());
    const PREV = getMonthRange(now.getFullYear(), now.getMonth() - 1);

    let selectedDate = new Date();
    let currentDate = new Date();
    let currentMonth = currentDate.getMonth();
    let currentYear = currentDate.getFullYear();
    let dashboardInitialized = false;

    // ------------------------------
    // DATE WIDGET
    // ------------------------------
    function updateDateWidget() {
        const now = new Date();
        const dayNames = ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'];
        const monthNames = [
            'January','February','March','April','May','June',
            'July','August','September','October','November','December'
        ];

        const dayEl = document.getElementById('current-day');
        const dayNameEl = document.getElementById('current-day-name');
        const monthYearEl = document.getElementById('current-month-year');

        if (!dayEl || !dayNameEl || !monthYearEl) return;

        dayEl.textContent = now.getDate();
        dayNameEl.textContent = dayNames[now.getDay()] + ",";
        monthYearEl.textContent = monthNames[now.getMonth()] + " " + now.getFullYear();
    }

    // ------------------------------
    // CALENDAR
    // ------------------------------
    function handleCalendarDayClick(year, month, day, element) {
        const calendarDays = document.getElementById('calendar-days');
        if (!calendarDays) return;

        calendarDays.querySelectorAll('.calendar-day').forEach(el => el.classList.remove('selected'));
        element.classList.add('selected');

        const clickedDate = new Date(year, month, day);
        updateStatsForDate(clickedDate);
    }

    function renderCalendar(month, year) {
        const monthNames = [
            "January","February","March","April","May","June",
            "July","August","September","October","November","December"
        ];

        const monthLabel = document.getElementById('calendar-month');
        const calendarDays = document.getElementById('calendar-days');
        if (!monthLabel || !calendarDays) return;

        monthLabel.textContent = `${monthNames[month]} ${year}`;

        const firstDay = new Date(year, month, 1).getDay();
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        const daysInPrevMonth = new Date(year, month, 0).getDate();
        calendarDays.innerHTML = '';

        const today = new Date();

        // previous month days
        for (let i = firstDay - 1; i >= 0; i--) {
            const d = document.createElement('div');
            d.className = 'calendar-day other-month';
            d.textContent = daysInPrevMonth - i;
            calendarDays.appendChild(d);
        }

        // current month days
        for (let i = 1; i <= daysInMonth; i++) {
            const d = document.createElement('div');
            d.className = 'calendar-day';
            d.textContent = i;

            if (i === today.getDate() && month === today.getMonth() && year === today.getFullYear()) {
                d.classList.add('today');
            }

            if (
                selectedDate &&
                selectedDate.getFullYear() === year &&
                selectedDate.getMonth() === month &&
                selectedDate.getDate() === i
            ) {
                d.classList.add('selected');
            }

            d.addEventListener('click', () => handleCalendarDayClick(year, month, i, d));
            calendarDays.appendChild(d);
        }

        // next month days
        const totalCells = 42;
        const usedCells = firstDay + daysInMonth;
        const remaining = totalCells - usedCells;
        for (let i = 1; i <= remaining; i++) {
            const d = document.createElement('div');
            d.className = 'calendar-day other-month';
            d.textContent = i;
            calendarDays.appendChild(d);
        }
    }

    function initCalendar() {
        renderCalendar(currentMonth, currentYear);

        const prevBtn = document.getElementById('prev-month');
        const nextBtn = document.getElementById('next-month');

        if (prevBtn) {
            prevBtn.addEventListener('click', function () {
                currentMonth--;
                if (currentMonth < 0) { currentMonth = 11; currentYear--; }
                renderCalendar(currentMonth, currentYear);
            });
        }

        if (nextBtn) {
            nextBtn.addEventListener('click', function () {
                currentMonth++;
                if (currentMonth > 11) { currentMonth = 0; currentYear++; }
                renderCalendar(currentMonth, currentYear);
            });
        }
    }

    // ------------------------------
    // DASHBOARD STATS (WELCOME CARDS)
    // ------------------------------
    function updateRevenueForDate(date) {
        const target = document.querySelector('.welcome-stats .welcome-stat:nth-child(1) .stat-number');
        if (!target) return;

        const { start, end } = getDayRange(date);

        db.collection("orders")
            .where("createdAt", ">=", start)
            .where("createdAt", "<=", end)
            .get()
            .then(snapshot => {
                let total = 0;
                snapshot.forEach(doc => total += Number(doc.data().total || 0));
                target.textContent = "₹" + total.toFixed(2);
            })
            .catch(() => {
                target.textContent = "₹0.00";
            });
    }

    function updateNewCustomersForDate(date) {
        const target = document.querySelector('.welcome-stats .welcome-stat:nth-child(3) .stat-number');
        if (!target) return;

        const { start, end } = getDayRange(date);

        db.collection("users")
            .where("createdAt", ">=", start)
            .where("createdAt", "<=", end)
            .get()
            .then(snapshot => {
                target.textContent = snapshot.size;
            })
            .catch(() => {
                target.textContent = "0";
            });
    }

    function updateMessagesForDate(date) {
        const target = document.querySelector('.welcome-stats .welcome-stat:nth-child(4) .stat-number');
        if (!target) return;

        const { start, end } = getDayRange(date);

        db.collection("contactSubmissions")
            .where("timestamp", ">=", start)
            .where("timestamp", "<=", end)
            .get()
            .then(snapshot => {
                target.textContent = snapshot.size;
            })
            .catch(() => {
                target.textContent = "0";
            });
    }

    function updatePendingOrdersCount() {
        const target = document.querySelector('.welcome-stats .welcome-stat:nth-child(2) .stat-number');
        if (!target) return;

        db.collection("orders")
            .where("status", "==", "pending")
            .onSnapshot(snapshot => {
                target.textContent = snapshot.size;
            });
    }

    function updateStatsForDate(date) {
        selectedDate = new Date(date.getTime());
        updateRevenueForDate(selectedDate);
        updateNewCustomersForDate(selectedDate);
        updateMessagesForDate(selectedDate);
    }

    // ------------------------------
    // SIDEBAR METRICS (MONTHLY)
    // ------------------------------
    function updateMonthlyRevenueMetric() {
        const valueEl = document.querySelector('.metric-row:nth-child(1) .metric-value');
        const changeEl = document.querySelector('.metric-row:nth-child(1) .metric-change');
        if (!valueEl || !changeEl) return;

        Promise.all([
            db.collection("orders")
                .where("createdAt", ">=", CUR.start)
                .where("createdAt", "<=", CUR.end)
                .get(),
            db.collection("orders")
                .where("createdAt", ">=", PREV.start)
                .where("createdAt", "<=", PREV.end)
                .get()
        ]).then(([curSnap, prevSnap]) => {
            let curTotal = 0, prevTotal = 0;
            curSnap.forEach(d => curTotal += Number(d.data().total || 0));
            prevSnap.forEach(d => prevTotal += Number(d.data().total || 0));

            valueEl.textContent = "₹" + curTotal.toFixed(2);

            const pct = calcPercentChange(curTotal, prevTotal);
            if (pct >= 0) {
                changeEl.innerHTML = `<i class="fas fa-arrow-up"></i> ${pct.toFixed(1)}%`;
                changeEl.classList.remove('negative');
            } else {
                changeEl.innerHTML = `<i class="fas fa-arrow-down"></i> ${Math.abs(pct).toFixed(1)}%`;
                changeEl.classList.add('negative');
            }
        });
    }

    function updateTotalCustomersMetric() {
        const valueEl = document.querySelector('.metric-row:nth-child(2) .metric-value');
        const changeEl = document.querySelector('.metric-row:nth-child(2) .metric-change');
        if (!valueEl || !changeEl) return;

        Promise.all([
            db.collection("users").get(),
            db.collection("users").where("createdAt", ">=", CUR.start).where("createdAt", "<=", CUR.end).get(),
            db.collection("users").where("createdAt", ">=", PREV.start).where("createdAt", "<=", PREV.end).get()
        ]).then(([allSnap, curSnap, prevSnap]) => {
            const allCount = allSnap.size;
            const curCount = curSnap.size;
            const prevCount = prevSnap.size;

            valueEl.textContent = allCount;
            const pct = calcPercentChange(curCount, prevCount);

            if (pct >= 0) {
                changeEl.innerHTML = `<i class="fas fa-arrow-up"></i> ${pct.toFixed(1)}%`;
                changeEl.classList.remove('negative');
            } else {
                changeEl.innerHTML = `<i class="fas fa-arrow-down"></i> ${Math.abs(pct).toFixed(1)}%`;
                changeEl.classList.add('negative');
            }
        });
    }

    function updateTotalOrdersMetric() {
        const valueEl = document.querySelector('.metric-row:nth-child(3) .metric-value');
        const changeEl = document.querySelector('.metric-row:nth-child(3) .metric-change');
        if (!valueEl || !changeEl) return;

        Promise.all([
            db.collection("orders").get(),
            db.collection("orders").where("createdAt", ">=", CUR.start).where("createdAt", "<=", CUR.end).get(),
            db.collection("orders").where("createdAt", ">=", PREV.start).where("createdAt", "<=", PREV.end).get()
        ]).then(([allSnap, curSnap, prevSnap]) => {
            const allCount = allSnap.size;
            const curCount = curSnap.size;
            const prevCount = prevSnap.size;

            valueEl.textContent = allCount;
            const pct = calcPercentChange(curCount, prevCount);

            if (pct >= 0) {
                changeEl.innerHTML = `<i class="fas fa-arrow-up"></i> ${pct.toFixed(1)}%`;
                changeEl.classList.remove('negative');
            } else {
                changeEl.innerHTML = `<i class="fas fa-arrow-down"></i> ${Math.abs(pct).toFixed(1)}%`;
                changeEl.classList.add('negative');
            }
        });
    }

    function updateTotalMessagesMetric() {
        const valueEl = document.querySelector('.metric-row:nth-child(4) .metric-value');
        const changeEl = document.querySelector('.metric-row:nth-child(4) .metric-change');
        if (!valueEl || !changeEl) return;

        Promise.all([
            db.collection("contactSubmissions").get(),
            db.collection("contactSubmissions").where("timestamp", ">=", CUR.start).where("timestamp", "<=", CUR.end).get(),
            db.collection("contactSubmissions").where("timestamp", ">=", PREV.start).where("timestamp", "<=", PREV.end).get()
        ]).then(([allSnap, curSnap, prevSnap]) => {
            const allCount = allSnap.size;
            const curCount = curSnap.size;
            const prevCount = prevSnap.size;

            valueEl.textContent = allCount;
            const pct = calcPercentChange(curCount, prevCount);

            if (pct >= 0) {
                changeEl.innerHTML = `<i class="fas fa-arrow-up"></i> ${pct.toFixed(1)}%`;
                changeEl.classList.remove('negative');
            } else {
                changeEl.innerHTML = `<i class="fas fa-arrow-down"></i> ${Math.abs(pct).toFixed(1)}%`;
                changeEl.classList.add('negative');
            }
        });
    }

    // ------------------------------
    // RECENT ORDERS
    // ------------------------------
    function renderDashboardEmptyOrders(list) {
        list.innerHTML = "";
        const div = document.createElement("div");
        div.className = "order-item order-item-empty fade-in";
        div.style.width = "100%";
        div.style.minWidth = "100%";
        div.style.textAlign = "center";
        div.style.padding = "22px";

        div.innerHTML = `
            <div style="font-size: 1rem; font-weight: 600; margin-bottom: 6px;">
                No orders yet
            </div>
            <div style="font-size: 0.85rem; color: #64748b;">
                New orders will appear here as soon as they are placed.
            </div>
        `;
        list.appendChild(div);
    }

// IN DASHBOARD SCRIPT - FIND AND REPLACE THIS FUNCTION:
function loadDashboardRecentOrders() {
  const list = document.getElementById("dashboardRecentOrders");
  if (!list) return;

  renderDashboardEmptyOrders(list);

  // ADD CLEANUP AND LIMIT
  if (window.dashboardOrdersListener) {
    window.dashboardOrdersListener();
  }

  window.dashboardOrdersListener = db.collection("orders")
    .orderBy("createdAt", "desc")
    .limit(5) // KEEP 5 FOR DASHBOARD (small preview)
    .onSnapshot(snapshot => {
      if (snapshot.empty) {
        renderDashboardEmptyOrders(list);
        return;
      }

      list.innerHTML = "";
      snapshot.forEach(doc => {
        const o = doc.data();
        const div = document.createElement("div");
        div.className = "order-item fade-in";

        const total = Number(o.total || 0).toFixed(2);
        const status = (o.status || "pending").toLowerCase();
        const label = status.charAt(0).toUpperCase() + status.slice(1);

        div.innerHTML = `
          <div class="order-info">
            <div class="order-icon"><i class="fas fa-shopping-bag"></i></div>
            <div class="order-details">
              <div class="order-id">#${doc.id.substring(0, 8)}</div>
              <div class="order-amount">₹${total}</div>
            </div>
          </div>
          <div class="order-status ${statusClass(status)}">${label}</div>
        `;

        list.appendChild(div);
      });
    }, () => {
      renderDashboardEmptyOrders(list);
    });
}
    // ------------------------------
    // PAGE LOADING (OTHER PAGES)
    // ------------------------------
    function showDashboard() {
        const dynamic = document.getElementById("dynamicPage");
        const dashboard = document.getElementById("dashboardBody");
        if (!dynamic || !dashboard) return;

        dashboard.style.display = "block";
        dynamic.style.display = "none";
        dynamic.innerHTML = "";
    }

// REPLACE EXISTING loadHTML FUNCTION IN DASHBOARD
async function loadHTML(page) {
  const dynamic = document.getElementById("dynamicPage");
  const dashboard = document.getElementById("dashboardBody");
  if (!dynamic || !dashboard) return;

  // Cleanup previous page
  cleanupManager.cleanup();
  
  // Show loading state
  dynamic.innerHTML = `
    <div style="display:flex;justify-content:center;align-items:center;min-height:400px">
      <div style="text-align:center">
        <i class="fas fa-spinner fa-spin" style="font-size:32px;color:var(--accent);margin-bottom:16px"></i>
        <div style="color:var(--muted);font-size:0.9rem">Loading...</div>
      </div>
    </div>
  `;
  
  dashboard.style.display = "none";
  dynamic.style.display = "block";

  try {
    const response = await fetch(page + '?v=' + Date.now());
    if (!response.ok) throw new Error('Failed to load');
    
    const html = await response.text();
    dynamic.innerHTML = html;
    
    // Execute scripts safely with cleanup
    const scripts = dynamic.querySelectorAll('script');
    for (const script of scripts) {
      try {
        if (script.src) {
          await new Promise((resolve, reject) => {
            const newScript = document.createElement('script');
            newScript.src = script.src;
            cleanupManager.add(() => newScript.remove());
            newScript.onload = resolve;
            newScript.onerror = reject;
            document.head.appendChild(newScript);
          });
        } else {
          const executeFn = new Function(script.textContent);
          executeFn();
        }
      } catch (err) {
        console.warn('Script execution failed:', err);
      }
    }
  } catch (error) {
    dynamic.innerHTML = `
      <div style="text-align:center;padding:60px;color:var(--danger)">
        <i class="fas fa-exclamation-triangle" style="font-size:48px;margin-bottom:16px"></i>
        <div style="font-weight:600;margin-bottom:8px">Failed to load page</div>
        <div style="color:var(--muted);font-size:0.9rem">Please try refreshing</div>
      </div>
    `;
  }
}


function loadMessagesPage() {
    loadHTML("contact-submissions.html").then(() => {
        const user = firebase.auth().currentUser;
        if (user) {
            setTimeout(() => {
                if (window.messagesManager) {
                    window.messagesManager.cleanup();
                }
                window.messagesManager = new MessagesManager();
            }, 100);
        }
    });
}

function loadPromoPage()    { loadHTML("promo-codes.html"); }
    function loadOrdersPage()   { loadHTML("orders.html"); }
    function loadCustomersPage(){ loadHTML("customers.html"); }
    function loadReviewsPage() { loadHTML("reviews.html"); }

    // ------------------------------
    // MOBILE MENU
    // ------------------------------
    function toggleMobileMenu() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        if (!sidebar || !overlay) return;

        sidebar.classList.toggle('active');
        overlay.classList.toggle('active');
    }

    function closeMobileMenu() {
        const sidebar = document.getElementById('sidebar');
        const overlay = document.getElementById('sidebarOverlay');
        if (!sidebar || !overlay) return;

        sidebar.classList.remove('active');
        overlay.classList.remove('active');
    }

    function setupMobileMenu() {
        const mobileMenuBtn = document.getElementById('mobileMenuBtn');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        if (mobileMenuBtn) mobileMenuBtn.addEventListener('click', toggleMobileMenu);
        if (sidebarOverlay) sidebarOverlay.addEventListener('click', closeMobileMenu);
    }
    
    function updateBadge(el, count) {
    if (!el) return;
    if (count > 0) {
        el.style.display = "inline-block";
        el.textContent = count;
    } else {
        el.style.display = "none";
        el.textContent = "";
    }
}

function initMenuCounts() {
    checkNewItems("orders", LAST_OPEN.orders, document.getElementById("countOrders"), "createdAt");
    checkNewItems("users", LAST_OPEN.customers, document.getElementById("countCustomers"), "createdAt");
    checkNewItems("contactSubmissions", LAST_OPEN.messages, document.getElementById("countMessages"), "timestamp");


}


    // ------------------------------
    // MENU CLICK EVENTS
    // ------------------------------
    function setupEventListeners() {
        const menuItems = document.querySelectorAll('.menu-item');
        menuItems.forEach(item => {
            item.addEventListener('click', function () {
                const menuText = this.querySelector('.menu-text').textContent.trim();
                menuItems.forEach(i => i.classList.remove('active'));
                this.classList.add('active');

              switch (menuText) {
 case 'Orders':
    localStorage.setItem(LAST_OPEN.orders, Date.now());
    document.getElementById("countOrders").style.display = "none";
    initMenuCounts();     // <--- ADD THIS
    loadOrdersPage();
    break;


case 'Customers':
    localStorage.setItem(LAST_OPEN.customers, Date.now());
    document.getElementById("countCustomers").style.display = "none";
    initMenuCounts();
    loadCustomersPage();
    break;


case 'Messages':
    localStorage.setItem(LAST_OPEN.messages, Date.now());
    document.getElementById("countMessages").style.display = "none";
    initMenuCounts();
    loadMessagesPage();
    break;

case 'Reviews':
    loadReviewsPage();
    break;


}


                if (window.innerWidth <= 992) closeMobileMenu();
            });
        });

        // profile dropdown
        const adminProfile = document.getElementById("adminProfile");
        const profileMenu = document.getElementById("profileMenu");
        if (adminProfile && profileMenu) {
            adminProfile.addEventListener('click', (e) => {
                e.stopPropagation();
                profileMenu.style.display = (profileMenu.style.display === "block") ? "none" : "block";
            });

            document.addEventListener('click', () => {
                profileMenu.style.display = "none";
            });
        }

        // placeholder review actions
        const publishBtn = document.getElementById("publishReviewBtn");
        const removeBtn = document.getElementById("removeReviewBtn");
        const createBtn = document.getElementById("createReviewBtn");

        if (publishBtn) publishBtn.addEventListener('click', () => console.log("Publish reviews clicked"));
        if (removeBtn) removeBtn.addEventListener('click', () => console.log("Remove reviews clicked"));
        if (createBtn) createBtn.addEventListener('click', () => console.log("Create review clicked"));
    }
    
    const LAST_OPEN = {
    orders: "lastOpenOrders",
    customers: "lastOpenCustomers",
    messages: "lastOpenMessages"
};

async function checkNewItems(collection, lastKey, badgeEl, field) {
    const lastOpen = Number(localStorage.getItem(lastKey)) || 0;

    db.collection(collection)
      .where(field, ">", firebase.firestore.Timestamp.fromMillis(lastOpen))
      .onSnapshot(snap => {
          if (snap.size > 0) {
              badgeEl.style.display = "inline-block";
              badgeEl.textContent = snap.size;
          } else {
              badgeEl.style.display = "none";
              badgeEl.textContent = "";
          }
      });
}

const menuListeners = {
    orders: null,
    customers: null,
    messages: null
};



   // REPLACE EXISTING initDashboard FUNCTION
function initDashboard() {
  if (dashboardInitialized) return;
  dashboardInitialized = true;

  // Phase 1: Immediate UI setup
  setupEventListeners();
  setupMobileMenu();
  updateDateWidget();
  initCalendar();

  // Phase 2: Light data (after 200ms)
  setTimeout(() => {
    loadDashboardRecentOrders();
    updatePendingOrdersCount();
  }, 200);

  // Phase 3: Heavy data (after 500ms)  
  setTimeout(() => {
    updateDashboardMetrics();
  }, 500);

  const dynamicPage = document.getElementById("dynamicPage");
  if (dynamicPage) dynamicPage.style.display = "none";
}

// NEW: Combined metrics function
async function updateDashboardMetrics() {
  try {
    await Promise.all([
      updateMonthlyRevenueMetric(),
      updateTotalCustomersMetric(), 
      updateTotalOrdersMetric(),
      updateTotalMessagesMetric(),
      updateStatsForDate(new Date())
    ]);
  } catch (error) {
    console.warn('Dashboard metrics loading failed:', error);
  }
}

    // ------------------------------
    const loginModal   = document.getElementById("loginModal");
    const dashboardEl  = document.getElementById("dashboardBody");
    const sidebarEl    = document.getElementById("sidebar");
    const topHeaderEl  = document.querySelector(".top-header");
    const loginEmailEl = document.getElementById("loginEmail");
    const loginPassEl  = document.getElementById("loginPassword");
    const loginErrorEl = document.getElementById("loginError");
    const loginBtn     = document.getElementById("loginSubmit");
    const logoutBtn    = document.getElementById("logoutBtn");

    // Initial UI state – force login first
    if (dashboardEl) dashboardEl.style.display = "none";
    if (sidebarEl) sidebarEl.style.display = "none";
    if (topHeaderEl) topHeaderEl.style.display = "none";
    if (loginModal) loginModal.style.display = "flex";

    // LOGIN BUTTON HANDLER
    if (loginBtn) {
        loginBtn.addEventListener("click", () => {
            const email = loginEmailEl ? loginEmailEl.value.trim() : "";
            const password = loginPassEl ? loginPassEl.value : "";

            if (loginErrorEl) loginErrorEl.textContent = "";

            if (!email || !password) {
                if (loginErrorEl) loginErrorEl.textContent = "Enter email and password.";
                return;
            }

            firebase.auth().signInWithEmailAndPassword(email, password)
                .catch(err => {
                    console.error(err);
                    if (loginErrorEl) loginErrorEl.textContent = "Invalid email or password.";
                });
        });
    }

    // LOGOUT BUTTON HANDLER
    if (logoutBtn) {
        logoutBtn.addEventListener("click", (e) => {
            e.stopPropagation();
            firebase.auth().signOut().catch(console.error);
        });
    }

    // AUTH STATE OBSERVER – only allow users with admin custom claim
    firebase.auth().onAuthStateChanged(async (user) => {
        
        if (!localStorage.getItem(LAST_OPEN.orders)) localStorage.setItem(LAST_OPEN.orders, Date.now());
if (!localStorage.getItem(LAST_OPEN.customers)) localStorage.setItem(LAST_OPEN.customers, Date.now());
if (!localStorage.getItem(LAST_OPEN.messages)) localStorage.setItem(LAST_OPEN.messages, Date.now());


        if (!user) {
            // Not logged in → show login, hide dashboard
            if (loginModal) loginModal.style.display = "flex";
            if (dashboardEl) dashboardEl.style.display = "none";
            if (sidebarEl) sidebarEl.style.display = "none";
            if (topHeaderEl) topHeaderEl.style.display = "none";
            dashboardInitialized = false;
            return;
        }

        try {
            // Force refresh token to read latest custom claims
            const tokenResult = await user.getIdTokenResult(true);

            // Check for admin flag set via custom claims
            if (!tokenResult.claims || tokenResult.claims.admin !== true) {
                // Not admin → kick out
                await firebase.auth().signOut();
                alert("Access denied. Admin only.");
                return;
            }
        } catch (err) {
            console.error("Error checking admin claim:", err);
            await firebase.auth().signOut();
            return;
        }

        // If we reach here → user is admin
        if (loginModal) loginModal.style.display = "none";
        if (dashboardEl) dashboardEl.style.display = "block";
        if (sidebarEl) sidebarEl.style.display = "block";
        if (topHeaderEl) topHeaderEl.style.display = "flex";

        const adminName = document.getElementById("adminName");
        if (adminName && user.email) adminName.textContent = user.email;
        
        initMenuCounts();

        initDashboard();
    });
</script>
</body>
</html>
