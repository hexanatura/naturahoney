<!DOCTYPE html>
<html lang="en" class="scroll-smooth">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes" />
  <title>Promo Code Management - Natura Honey</title>
  <!-- Google Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Unbounded:wght@200;300;400;500;600;700;800;900&display=swap" rel="stylesheet" />
  <link href="https://fonts.cdnfonts.com/css/akira-expanded" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;500;600&family=Quicksand:wght@300;400;500;600&display=swap" rel="stylesheet">
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
  <script src="https://cdn.tailwindcss.com"></script>
  
  <!-- Firebase SDK -->
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
  
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    body {
      background-color: #f8f9fa;
      color: #333;
      line-height: 1.6;
      font-family: 'Unbounded', sans-serif;
    }
    
    .admin-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 80px 20px 40px;
    }
    
    .admin-header {
      text-align: center;
      margin-bottom: 40px;
    }
    
    .admin-header h1 {
      font-family: 'Akira Expanded', sans-serif;
      font-size: 2.5rem;
      color: #5f2b27;
      margin-bottom: 10px;
    }
    
    .admin-header p {
      color: #666;
      font-size: 1.1rem;
    }
    
    .admin-actions {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      gap: 20px;
    }
    
    .btn {
      background: #5f2b27;
      color: white;
      border: none;
      padding: 12px 24px;
      border-radius: 8px;
      font-family: 'Unbounded', sans-serif;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.3s;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    
    .btn:hover {
      background: #7a3731;
      transform: translateY(-2px);
    }
    
    .btn-success {
      background: #27ae60;
    }
    
    .btn-success:hover {
      background: #219653;
    }
    
    .btn-danger {
      background: #e74c3c;
    }
    
    .btn-danger:hover {
      background: #c0392b;
    }
    
    .btn-outline {
      background: transparent;
      border: 2px solid #5f2b27;
      color: #5f2b27;
    }
    
    .btn-outline:hover {
      background: #5f2b27;
      color: white;
    }
    
    .promo-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
      gap: 20px;
      margin-bottom: 40px;
    }
    
    .promo-card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
      border-left: 4px solid #5f2b27;
      position: relative;
    }
    
    .promo-card.expired {
      opacity: 0.7;
      border-left-color: #95a5a6;
    }
    
    .promo-card.inactive {
      opacity: 0.5;
      border-left-color: #bdc3c7;
    }
    
    .promo-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 15px;
    }
    
    .promo-code {
      font-family: 'Akira Expanded', sans-serif;
      font-size: 1.5rem;
      color: #5f2b27;
      background: rgba(95, 43, 39, 0.1);
      padding: 5px 12px;
      border-radius: 20px;
    }
    
    .promo-status {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 0.8rem;
      font-weight: 600;
    }
    
    .status-active {
      color: #27ae60;
    }
    
    .status-inactive {
      color: #e74c3c;
    }
    
    .status-expired {
      color: #f39c12;
    }
    
    .promo-details {
      margin-bottom: 15px;
    }
    
    .promo-type {
      display: inline-block;
      background: #e7d90f;
      color: #333;
      padding: 4px 8px;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-bottom: 8px;
    }
    
    .promo-description {
      font-weight: 500;
      margin-bottom: 5px;
    }
    
    .promo-terms {
      font-size: 0.85rem;
      color: #666;
      margin-bottom: 8px;
    }
    
    .promo-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.8rem;
      color: #888;
      margin-bottom: 15px;
    }
    
    .promo-actions {
      display: flex;
      gap: 8px;
    }
    
    .btn-sm {
      padding: 6px 12px;
      font-size: 0.8rem;
    }
    
    /* Modal Styles */
    .modal {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.5);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }
    
    .modal.active {
      display: flex;
    }
    
    .modal-content {
      background: white;
      border-radius: 15px;
      padding: 30px;
      width: 90%;
      max-width: 500px;
      max-height: 90vh;
      overflow-y: auto;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
    }
    
    .modal-title {
      font-family: 'Akira Expanded', sans-serif;
      font-size: 1.5rem;
      color: #5f2b27;
    }
    
    .close-modal {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #666;
    }
    
    .form-group {
      margin-bottom: 15px;
    }
    
    .form-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      font-size: 0.9rem;
    }
    
    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-family: 'Unbounded', sans-serif;
      font-size: 0.9rem;
    }
    
    .form-group textarea {
      height: 80px;
      resize: vertical;
    }
    
 .form-row {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 15px;
}

.form-row .checkbox-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

@media (max-width: 768px) {
  .form-row {
    grid-template-columns: 1fr;
  }
}
    
    .checkbox-group {
      display: flex;
      align-items: center;
      gap: 8px;
    }
    
    .checkbox-group input {
      width: auto;
    }
    
    .form-actions {
      display: flex;
      gap: 10px;
      justify-content: flex-end;
      margin-top: 20px;
    }
    
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: #666;
    }
    
    .empty-state i {
      font-size: 4rem;
      margin-bottom: 20px;
      color: #e0e0e0;
    }
    
    .empty-state h3 {
      font-size: 1.5rem;
      margin-bottom: 10px;
    }
    
    /* Loading State */
    .loading {
      text-align: center;
      padding: 40px;
      color: #666;
    }
    
    .loading i {
      font-size: 2rem;
      margin-bottom: 10px;
    }
    
    /* Toast Notification */
    .toast {
      position: fixed;
      top: 20px;
      right: 20px;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      font-weight: 500;
      z-index: 1001;
      transform: translateX(400px);
      transition: transform 0.3s ease;
    }
    
    .toast.show {
      transform: translateX(0);
    }
    
    .toast.success {
      background: #27ae60;
    }
    
    .toast.error {
      background: #e74c3c;
    }
    
    /* Responsive */
    @media (max-width: 768px) {
      .admin-actions {
        flex-direction: column;
        align-items: stretch;
      }
      
      .promo-grid {
        grid-template-columns: 1fr;
      }
      
      .promo-header {
        flex-direction: column;
        align-items: flex-start;
        gap: 10px;
      }
      
      .promo-actions {
        flex-wrap: wrap;
      }
      
      .toast {
        left: 20px;
        right: 20px;
        transform: translateY(-100px);
      }
      
      .toast.show {
        transform: translateY(0);
      }
    }
  </style>
</head>
<body>
  <!-- Admin Promo Code Management -->
  <div class="admin-container">
    <div class="admin-header">
      <h1>Promo Code Management</h1>
      <p>Create and manage discount codes for your customers</p>
    </div>
    
    <div class="admin-actions">
      <div class="search-box">
        <input type="text" id="searchInput" placeholder="Search promo codes..." style="padding: 10px; border: 1px solid #ddd; border-radius: 6px; width: 300px; max-width: 100%;">
      </div>
      <button class="btn" id="addPromoBtn">
        <i class="fas fa-plus"></i> Create New Promo Code
      </button>
    </div>
    
    <div id="promoCodesContainer">
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading promo codes...</p>
      </div>
    </div>
  </div>
  
  <!-- Toast Notification -->
  <div class="toast" id="toast"></div>
  
  <!-- Add/Edit Promo Code Modal -->
  <div class="modal" id="promoModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title" id="modalTitle">Create New Promo Code</h3>
        <button class="close-modal" id="closeModal">&times;</button>
      </div>
      
      <form id="promoForm">
        <input type="hidden" id="promoId">
        
        <div class="form-group">
          <label for="promoCode" class="required">Promo Code</label>
          <input type="text" id="promoCode" required placeholder="e.g., WELCOME10" style="text-transform: uppercase;">
          <small style="color: #666; font-size: 0.8rem;">Use uppercase letters and numbers only</small>
        </div>
        
        <div class="form-group">
          <label for="promoType" class="required">Discount Type</label>
          <select id="promoType" required>
            <option value="">Select Type</option>
            <option value="fixed">Fixed Amount (₹)</option>
            <option value="percentage">Percentage (%)</option>
            <option value="shipping">Free Shipping</option>
          </select>
        </div>
        
        <div class="form-row">
          <div class="form-group" id="valueField">
            <label for="promoValue" class="required">Discount Value</label>
            <input type="number" id="promoValue" min="0" step="0.01" placeholder="e.g., 50">
          </div>
          
          <div class="form-group" id="maxDiscountField" style="display: none;">
            <label for="maxDiscount">Max Discount (₹)</label>
            <input type="number" id="maxDiscount" min="0" step="0.01" placeholder="e.g., 200">
          </div>
        </div>
        
        <div class="form-group">
          <label for="minOrder">Minimum Order Amount (₹)</label>
          <input type="number" id="minOrder" min="0" step="0.01" placeholder="e.g., 299">
        </div>
        
        <div class="form-group">
          <label for="description" class="required">Description</label>
          <input type="text" id="description" required placeholder="e.g., Get ₹50 off on your first order">
        </div>
        
        <div class="form-group">
          <label for="terms">Terms & Conditions</label>
          <textarea id="terms" placeholder="e.g., Min. order ₹299. Valid for first-time customers only."></textarea>
        </div>
        
        <div class="form-row">
          <div class="form-group">
            <label for="validUntil">Valid Until</label>
            <input type="date" id="validUntil">
          </div>
          
          <div class="form-group">
            <label for="usageLimit">Usage Limit</label>
            <input type="number" id="usageLimit" min="0" placeholder="e.g., 100 (0 = unlimited)">
          </div>
        </div>
        
        <div class="form-row">
          <div class="checkbox-group">
            <input type="checkbox" id="isActive" checked>
            <label for="isActive">Active</label>
          </div>
          
          <div class="checkbox-group">
            <input type="checkbox" id="isPopular">
            <label for="isPopular">Mark as Popular</label>
          </div>
     
  <div class="checkbox-group">
    <input type="checkbox" id="showOnCheckout" checked>
    <label for="showOnCheckout">Show on Checkout Page</label>
  </div>
</div>
        
        <div class="form-actions">
          <button type="button" class="btn btn-outline" id="cancelBtn">Cancel</button>
          <button type="submit" class="btn" id="saveBtn">Save Promo Code</button>
        </div>
      </form>
    </div>
  </div>
  
  <!-- Confirmation Modal -->
  <div class="modal" id="confirmModal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">Confirm Action</h3>
        <button class="close-modal" id="closeConfirmModal">&times;</button>
      </div>
      <div class="modal-body">
        <p id="confirmMessage">Are you sure you want to delete this promo code?</p>
      </div>
      <div class="form-actions">
        <button type="button" class="btn btn-outline" id="cancelConfirmBtn">Cancel</button>
        <button type="button" class="btn btn-danger" id="confirmActionBtn">Confirm</button>
      </div>
    </div>
  </div>

  <script>
    // Firebase Configuration
    const firebaseConfig = {
      apiKey: "AIzaSyDuF6bdqprddsE871GuOablXPYqXI_HJxc",
      authDomain: "hexahoney-96aed.firebaseapp.com",
      projectId: "hexahoney-96aed",
      storageBucket: "hexahoney-96aed.firebasestorage.app",
      messagingSenderId: "700458850837",
      appId: "1:700458850837:web:0eb4fca98a5f4acc2d0c1c",
      measurementId: "G-MQGKK9709H"
    };

    // Initialize Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    // DOM Elements
    const promoCodesContainer = document.getElementById('promoCodesContainer');
    const addPromoBtn = document.getElementById('addPromoBtn');
    const promoModal = document.getElementById('promoModal');
    const confirmModal = document.getElementById('confirmModal');
    const closeModal = document.getElementById('closeModal');
    const closeConfirmModal = document.getElementById('closeConfirmModal');
    const cancelBtn = document.getElementById('cancelBtn');
    const cancelConfirmBtn = document.getElementById('cancelConfirmBtn');
    const confirmActionBtn = document.getElementById('confirmActionBtn');
    const promoForm = document.getElementById('promoForm');
    const searchInput = document.getElementById('searchInput');
    const promoType = document.getElementById('promoType');
    const valueField = document.getElementById('valueField');
    const maxDiscountField = document.getElementById('maxDiscountField');
    const toast = document.getElementById('toast');

    let currentPromoId = null;
    let promoCodes = [];

    // Event Listeners
    addPromoBtn.addEventListener('click', () => openModal());
    closeModal.addEventListener('click', () => closeModals());
    cancelBtn.addEventListener('click', () => closeModals());
    closeConfirmModal.addEventListener('click', () => closeModals());
    cancelConfirmBtn.addEventListener('click', () => closeModals());
    
    promoForm.addEventListener('submit', handleSavePromo);
    promoType.addEventListener('change', handleTypeChange);
    searchInput.addEventListener('input', handleSearch);

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
      loadPromoCodes();
    });

    // Load all promo codes
    function loadPromoCodes() {
      promoCodesContainer.innerHTML = `
        <div class="loading">
          <i class="fas fa-spinner fa-spin"></i>
          <p>Loading promo codes...</p>
        </div>
      `;

      db.collection('promoCodes').orderBy('createdAt', 'desc').get()
        .then((querySnapshot) => {
          promoCodes = [];
          querySnapshot.forEach((doc) => {
            promoCodes.push({
              id: doc.id,
              ...doc.data()
            });
          });
          displayPromoCodes(promoCodes);
        })
        .catch((error) => {
          console.error("Error loading promo codes:", error);
          promoCodesContainer.innerHTML = `
            <div class="empty-state">
              <i class="fas fa-exclamation-circle"></i>
              <h3>Error Loading Promo Codes</h3>
              <p>${error.message}</p>
              <button class="btn" onclick="loadPromoCodes()">Retry</button>
            </div>
          `;
        });
    }

// Display promo codes in grid
function displayPromoCodes(codes) {
  if (codes.length === 0) {
    promoCodesContainer.innerHTML = `
      <div class="empty-state">
        <i class="fas fa-tag"></i>
        <h3>No Promo Codes Found</h3>
        <p>Create your first promo code to get started</p>
      </div>
    `;
    return;
  }

  const html = `
    <div class="promo-grid">
      ${codes.map(promo => `
        <div class="promo-card ${!promo.active ? 'inactive' : ''} ${isExpired(promo) ? 'expired' : ''}">
          <div class="promo-header">
            <div class="promo-code">${promo.id}</div>
            <div class="promo-status">
              ${getStatusBadge(promo)}
            </div>
          </div>
          
          <div class="promo-details">
            <div class="promo-type">${getTypeLabel(promo.type)}</div>
            <div class="promo-description">${promo.description}</div>
            <div class="promo-terms">${promo.terms || 'No specific terms'}</div>
          </div>
          
          <div class="promo-meta">
            <div>
              <strong>Value:</strong> ${getValueDisplay(promo)}
            </div>
            <div>
              <strong>Min Order:</strong> ₹${promo.minOrder || 0}
            </div>
          </div>
          
          <div class="promo-meta">
            <div>
              <strong>Valid Until:</strong> ${promo.validUntil ? new Date(promo.validUntil).toLocaleDateString() : 'No expiry'}
            </div>
            <div>
              <strong>Usage Limit:</strong> ${promo.usageLimit || 'Unlimited'}
            </div>
          </div>

          <!-- ADD THIS NEW META ROW FOR CHECKOUT VISIBILITY -->
          <div class="promo-meta">
            <div>
              <strong>Checkout Display:</strong> 
              <span style="color: ${promo.showOnCheckout !== false ? '#27ae60' : '#e74c3c'}">
                ${promo.showOnCheckout !== false ? 'Visible' : 'Hidden'}
              </span>
            </div>
            <div>
              <strong>Popular:</strong> 
              <span style="color: ${promo.isPopular ? '#e7d90f' : '#666'}">
                ${promo.isPopular ? 'Yes' : 'No'}
              </span>
            </div>
          </div>
          
          <div class="promo-actions">
            <button class="btn btn-sm" onclick="editPromo('${promo.id}')">
              <i class="fas fa-edit"></i> Edit
            </button>
            <button class="btn btn-sm ${promo.active ? 'btn-danger' : 'btn-success'}" onclick="togglePromoStatus('${promo.id}', ${!promo.active})">
              <i class="fas ${promo.active ? 'fa-pause' : 'fa-play'}"></i> ${promo.active ? 'Deactivate' : 'Activate'}
            </button>
            <button class="btn btn-sm btn-danger" onclick="deletePromo('${promo.id}')">
              <i class="fas fa-trash"></i> Delete
            </button>
          </div>
        </div>
      `).join('')}
    </div>
  `;

  promoCodesContainer.innerHTML = html;
}

    // Open modal for creating/editing
    function openModal(promo = null) {
      const modalTitle = document.getElementById('modalTitle');
      const form = document.getElementById('promoForm');
      
      if (promo) {
        modalTitle.textContent = 'Edit Promo Code';
        currentPromoId = promo.id;
        fillForm(promo);
      } else {
        modalTitle.textContent = 'Create New Promo Code';
        currentPromoId = null;
        form.reset();
        document.getElementById('isActive').checked = true;
        document.getElementById('isPopular').checked = false;
      }
      
      promoModal.classList.add('active');
    }

// Fill form with promo data
function fillForm(promo) {
  document.getElementById('promoId').value = promo.id;
  document.getElementById('promoCode').value = promo.id;
  document.getElementById('promoType').value = promo.type;
  document.getElementById('promoValue').value = promo.value || '';
  document.getElementById('maxDiscount').value = promo.maxDiscount || '';
  document.getElementById('minOrder').value = promo.minOrder || '';
  document.getElementById('description').value = promo.description || '';
  document.getElementById('terms').value = promo.terms || '';
  document.getElementById('validUntil').value = promo.validUntil || '';
  document.getElementById('usageLimit').value = promo.usageLimit || '';
  document.getElementById('isActive').checked = promo.active !== false;
  document.getElementById('isPopular').checked = promo.isPopular || false;
  document.getElementById('showOnCheckout').checked = promo.showOnCheckout !== false; // Default to true
  
  handleTypeChange(); // Update visibility based on type
}

    // Handle promo type change
    function handleTypeChange() {
      const type = promoType.value;
      
      if (type === 'percentage') {
        valueField.style.display = 'block';
        maxDiscountField.style.display = 'block';
        document.getElementById('promoValue').placeholder = 'e.g., 25 (for 25%)';
      } else if (type === 'fixed') {
        valueField.style.display = 'block';
        maxDiscountField.style.display = 'none';
        document.getElementById('promoValue').placeholder = 'e.g., 50 (for ₹50)';
      } else if (type === 'shipping') {
        valueField.style.display = 'none';
        maxDiscountField.style.display = 'none';
      }
    }

   function handleSavePromo(e) {
  e.preventDefault();
  
  const formData = {
    type: document.getElementById('promoType').value,
    value: document.getElementById('promoType').value !== 'shipping' ? parseFloat(document.getElementById('promoValue').value) : 0,
    maxDiscount: document.getElementById('maxDiscount').value ? parseFloat(document.getElementById('maxDiscount').value) : null,
    minOrder: document.getElementById('minOrder').value ? parseFloat(document.getElementById('minOrder').value) : 0,
    description: document.getElementById('description').value,
    terms: document.getElementById('terms').value,
    validUntil: document.getElementById('validUntil').value || null,
    usageLimit: document.getElementById('usageLimit').value ? parseInt(document.getElementById('usageLimit').value) : 0,
    active: document.getElementById('isActive').checked,
    isPopular: document.getElementById('isPopular').checked,
    showOnCheckout: document.getElementById('showOnCheckout').checked, // ADD THIS LINE
    updatedAt: firebase.firestore.FieldValue.serverTimestamp()
  };


      // Add createdAt for new promos
      if (!currentPromoId) {
        formData.createdAt = firebase.firestore.FieldValue.serverTimestamp();
      }

      const promoCode = document.getElementById('promoCode').value.trim().toUpperCase();
      
      if (!promoCode) {
        showToast('Please enter a promo code', 'error');
        return;
      }

      const saveBtn = document.getElementById('saveBtn');
      saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Saving...';
      saveBtn.disabled = true;

      const promise = currentPromoId 
        ? db.collection('promoCodes').doc(currentPromoId).update(formData)
        : db.collection('promoCodes').doc(promoCode).set(formData);

      promise
        .then(() => {
          showToast('Promo code saved successfully!', 'success');
          closeModals();
          loadPromoCodes();
        })
        .catch((error) => {
          console.error("Error saving promo code:", error);
          showToast('Error saving promo code: ' + error.message, 'error');
        })
        .finally(() => {
          saveBtn.innerHTML = 'Save Promo Code';
          saveBtn.disabled = false;
        });
    }

    // Edit promo code
    function editPromo(promoId) {
      const promo = promoCodes.find(p => p.id === promoId);
      if (promo) {
        openModal(promo);
      }
    }

    // Toggle promo status
    function togglePromoStatus(promoId, newStatus) {
      db.collection('promoCodes').doc(promoId).update({
        active: newStatus,
        updatedAt: firebase.firestore.FieldValue.serverTimestamp()
      })
      .then(() => {
        showToast(`Promo code ${newStatus ? 'activated' : 'deactivated'} successfully!`, 'success');
        loadPromoCodes();
      })
      .catch((error) => {
        console.error("Error updating promo status:", error);
        showToast('Error updating promo code: ' + error.message, 'error');
      });
    }

    // Delete promo code
    function deletePromo(promoId) {
      const promo = promoCodes.find(p => p.id === promoId);
      if (!promo) return;

      document.getElementById('confirmMessage').textContent = `Are you sure you want to delete promo code "${promoId}"? This action cannot be undone.`;
      confirmModal.classList.add('active');

      confirmActionBtn.onclick = () => {
        db.collection('promoCodes').doc(promoId).delete()
          .then(() => {
            showToast('Promo code deleted successfully!', 'success');
            closeModals();
            loadPromoCodes();
          })
          .catch((error) => {
            console.error("Error deleting promo code:", error);
            showToast('Error deleting promo code: ' + error.message, 'error');
          });
      };
    }

    // Search promo codes
    function handleSearch(e) {
      const searchTerm = e.target.value.toLowerCase();
      const filtered = promoCodes.filter(promo => 
        promo.id.toLowerCase().includes(searchTerm) ||
        promo.description.toLowerCase().includes(searchTerm)
      );
      displayPromoCodes(filtered);
    }

    // Helper functions
    function isExpired(promo) {
      if (!promo.validUntil) return false;
      return new Date(promo.validUntil) < new Date();
    }

    function getStatusBadge(promo) {
      if (!promo.active) {
        return '<span class="status-inactive"><i class="fas fa-pause-circle"></i> Inactive</span>';
      }
      if (isExpired(promo)) {
        return '<span class="status-expired"><i class="fas fa-clock"></i> Expired</span>';
      }
      return '<span class="status-active"><i class="fas fa-check-circle"></i> Active</span>';
    }

    function getTypeLabel(type) {
      const labels = {
        'fixed': 'Fixed Discount',
        'percentage': 'Percentage Off',
        'shipping': 'Free Shipping'
      };
      return labels[type] || type;
    }

    function getValueDisplay(promo) {
      if (promo.type === 'fixed') {
        return `₹${promo.value}`;
      } else if (promo.type === 'percentage') {
        return `${promo.value}%${promo.maxDiscount ? ` (max ₹${promo.maxDiscount})` : ''}`;
      } else if (promo.type === 'shipping') {
        return 'Free Shipping';
      }
      return '';
    }

    function closeModals() {
      promoModal.classList.remove('active');
      confirmModal.classList.remove('active');
    }

    function showToast(message, type = 'success') {
      toast.textContent = message;
      toast.className = `toast ${type} show`;
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Make functions global for onclick handlers
    window.editPromo = editPromo;
    window.togglePromoStatus = togglePromoStatus;
    window.deletePromo = deletePromo;
    window.loadPromoCodes = loadPromoCodes;
  </script>
</body>
</html>
