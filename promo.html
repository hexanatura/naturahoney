<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - Promo Codes</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .container { max-width: 800px; margin: 0 auto; }
        .form-group { margin-bottom: 15px; }
        label { display: block; margin-bottom: 5px; font-weight: bold; }
        input, select, textarea { width: 100%; padding: 8px; border: 1px solid #ddd; border-radius: 4px; }
        button { background: #5f2b27; color: white; padding: 10px 20px; border: none; border-radius: 4px; cursor: pointer; }
        .promo-list { margin-top: 30px; }
        .promo-item { border: 1px solid #ddd; padding: 15px; margin-bottom: 10px; border-radius: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>Promo Code Generator</h1>
        
        <form id="promoForm">
            <div class="form-group">
                <label for="code">Promo Code:</label>
                <input type="text" id="code" required placeholder="e.g., WELCOME10">
            </div>
            
            <div class="form-group">
                <label for="description">Description:</label>
                <textarea id="description" required placeholder="Description that users will see"></textarea>
            </div>
            
            <div class="form-group">
                <label for="discountType">Discount Type:</label>
                <select id="discountType" required>
                    <option value="percentage">Percentage</option>
                    <option value="fixed">Fixed Amount</option>
                </select>
            </div>
            
            <div class="form-group">
                <label for="discountValue">Discount Value:</label>
                <input type="number" id="discountValue" required min="1">
            </div>
            
            <div class="form-group">
                <label for="minOrderAmount">Minimum Order Amount (₹):</label>
                <input type="number" id="minOrderAmount" value="0" min="0">
            </div>
            
            <div class="form-group">
                <label for="maxUses">Maximum Uses:</label>
                <input type="number" id="maxUses" value="100" min="1">
            </div>
            
            <div class="form-group">
                <label for="validUntil">Valid Until:</label>
                <input type="datetime-local" id="validUntil" required>
            </div>
            
            <button type="submit">Generate Promo Code</button>
        </form>
        
        <div class="promo-list" id="promoList">
            <h2>Active Promo Codes</h2>
            <!-- Active promo codes will be listed here -->
        </div>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-firestore-compat.js"></script>
    <script>
        // Firebase config (same as your main app)
        const firebaseConfig = {
            apiKey: "AIzaSyDuF6bdqprddsE871GuOablXPYqXI_HJxc",
            authDomain: "hexahoney-96aed.firebaseapp.com",
            projectId: "hexahoney-96aed",
            storageBucket: "hexahoney-96aed.firebasestorage.app",
            messagingSenderId: "700458850837",
            appId: "1:700458850837:web:0eb4fca98a5f4acc2d0c1c",
            measurementId: "G-MQGKK9709H"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        document.getElementById('promoForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const promoData = {
                code: document.getElementById('code').value.toUpperCase(),
                description: document.getElementById('description').value,
                discountType: document.getElementById('discountType').value,
                discountValue: parseInt(document.getElementById('discountValue').value),
                minOrderAmount: parseInt(document.getElementById('minOrderAmount').value) || 0,
                maxUses: parseInt(document.getElementById('maxUses').value),
                usedCount: 0,
                isActive: true,
                validFrom: new Date(),
                validUntil: new Date(document.getElementById('validUntil').value),
                createdAt: new Date()
            };

            // Save to Firestore
            db.collection('promoCodes').add(promoData)
                .then(() => {
                    alert('Promo code created successfully!');
                    document.getElementById('promoForm').reset();
                    loadActivePromoCodes();
                })
                .catch((error) => {
                    console.error("Error creating promo code:", error);
                    alert('Error creating promo code: ' + error.message);
                });
        });

        function loadActivePromoCodes() {
            db.collection('promoCodes')
                .where('isActive', '==', true)
                .orderBy('createdAt', 'desc')
                .get()
                .then((querySnapshot) => {
                    const promoList = document.getElementById('promoList');
                    promoList.innerHTML = '<h2>Active Promo Codes</h2>';
                    
                    querySnapshot.forEach((doc) => {
                        const promo = doc.data();
                        const promoItem = document.createElement('div');
                        promoItem.className = 'promo-item';
                        promoItem.innerHTML = `
                            <strong>${promo.code}</strong> - ${promo.description}<br>
                            Discount: ${promo.discountType === 'percentage' ? promo.discountValue + '%' : '₹' + promo.discountValue}<br>
                            Min Order: ₹${promo.minOrderAmount} | Used: ${promo.usedCount}/${promo.maxUses}<br>
                            Valid Until: ${new Date(promo.validUntil).toLocaleDateString()}
                        `;
                        promoList.appendChild(promoItem);
                    });
                });
        }

        // Load active promo codes on page load
        loadActivePromoCodes();
    </script>
</body>
</html>
