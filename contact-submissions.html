<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">

<style>
:root{
  --dark:#000;
  --light:#f5f5f5;
  --gray:#666;
  --border:#e0e0e0;
  --card-bg:rgba(255,255,255,0.95);
  --radius:12px;
  --shadow:0 4px 12px rgba(0,0,0,0.1);
}

*{box-sizing:border-box;margin:0;padding:0}

.page-container{
  max-width:1400px;
  margin:24px auto;
  padding:20px;
  width:100%;
  overflow-x:auto;
}

.page-title{
  font-family:'Outfit',sans-serif;
  font-size:1.9rem;
  font-weight:700
}

.page-subtitle{
  color:var(--gray);
  margin-bottom:18px
}

.filters-bar{
  background:var(--card-bg);
  box-shadow:var(--shadow);
  border-radius:var(--radius);
  padding:14px 16px;
  margin-bottom:20px;
  display:flex;
  flex-wrap:wrap;
  gap:16px
}

.filter-group{
  flex:1;
  min-width:180px;
  display:flex;
  flex-direction:column
}

.filter-label{
  font-size:.8rem;
  color:var(--gray);
  margin-bottom:6px;
  font-weight:600
}

.filter-select{
  padding:10px 12px;
  border-radius:8px;
  border:1px solid var(--border);
  background:var(--card-bg);
  font-size:.95rem;
  box-shadow:var(--shadow)
}

.table-container{
  background:var(--card-bg);
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  overflow:hidden;
  margin-bottom:22px;
  overflow-x:auto;
}

table{
  width:100%;
  border-collapse:collapse;
  min-width:650px;
}

thead{background:rgba(0,0,0,0.04)}

th{
  padding:14px 16px;
  text-align:left;
  font-weight:600;
  font-size:.95rem;
  border-bottom:1px solid var(--border)
}

td{
  padding:12px 16px;
  font-size:.95rem;
  border-bottom:1px solid var(--border);
  vertical-align:middle
}

tr:hover{background:rgba(0,0,0,0.03)}

.user-info{
  display:flex;
  align-items:center;
  gap:12px
}

.avatar{
  width:40px;
  height:40px;
  border-radius:50%;
  background:#000;
  color:#fff;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700
}

.status{
  padding:6px 14px;
  border-radius:25px;
  font-size:.75rem;
  font-weight:700;
  display:inline-block
}

.status-new{background:#fff3f3;color:#b71c1c}
.status-read{background:#eaf4ff;color:#054a9b}
.status-replied{background:#e9fbef;color:#0f7a47}

.actions{
  display:flex;
  gap:8px
}

.action-btn{
  width:38px;
  height:38px;
  border-radius:10px;
  background:rgba(0,0,0,0.06);
  border:none;
  display:flex;
  align-items:center;
  justify-content:center;
  cursor:pointer;
  transition:all .14s
}

.action-btn:hover{
  transform:translateY(-3px);
  background:rgba(0,0,0,0.12)
}

.mobile-cards{
  display:none;
  flex-direction:column;
  gap:14px
}

.card{
  background:var(--card-bg);
  padding:16px;
  border-radius:var(--radius);
  box-shadow:var(--shadow);
  display:flex;
  flex-direction:column;
  gap:10px
}

.card-row{
  display:flex;
  justify-content:space-between;
  align-items:center
}

.card .meta{
  color:var(--gray);
  font-size:.85rem
}

.modal{
  position:fixed;
  inset:0;
  display:none;
  background:rgba(0,0,0,0.45);
  backdrop-filter:blur(4px);
  align-items:center;
  justify-content:center;
  z-index:1200;
  padding:20px;
}

.modal-content{
  background:var(--card-bg);
  width:100%;
  max-width:520px;
  border-radius:var(--radius);
  overflow:hidden;
  box-shadow:var(--shadow);
  max-height:90vh;
  overflow-y:auto;
}

.modal-header{
  padding:16px;
  background:#000;
  color:#fff;
  display:flex;
  justify-content:space-between;
  align-items:center;
}

.modal-body{padding:18px}

.detail-label{
  font-size:.8rem;color:var(--gray);
  margin-bottom:6px;font-weight:600
}

.detail-value{
  background:rgba(0,0,0,0.04);
  padding:12px;border-radius:10px;
  margin-bottom:12px;
  word-break:break-word;
}

.message-box{
  min-height:120px;
  max-height:200px;
  overflow:auto;
  white-space:pre-wrap;
}

.modal-footer{
  display:flex;
  gap:10px;
  justify-content:flex-end;
  padding:14px;
  border-top:1px solid var(--border);
  background:var(--card-bg);
}

.btn{
  padding:9px 16px;
  border-radius:10px;
  border:none;
  cursor:pointer;
  font-weight:700;
  font-size:14px;
}

.btn-primary{background:#000;color:#fff}
.btn-secondary{background:rgba(0,0,0,0.07)}

.toast{
  position:fixed;
  right:20px;
  bottom:20px;
  background:var(--card-bg);
  padding:12px 16px;
  border-radius:12px;
  box-shadow:var(--shadow);
  display:flex;
  gap:10px;
  align-items:center;
  transform:translateY(24px);
  opacity:0;
  transition:.25s;
  z-index:1300;
}

.toast.show{
  transform:none;
  opacity:1
}

/* MOBILE RESPONSIVE */
@media(max-width:1024px){
  .table-container{display:none}
  .mobile-cards{display:flex}
}

@media(min-width:1025px){
  .table-container{display:block}
  .mobile-cards{display:none}
}
</style>

<div class="page-container fade-in">

  <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:12px;flex-wrap:wrap;">
    <div>
      <div class="page-title">Contact Submissions</div>
      <div class="page-subtitle">Manage and respond to customer inquiries</div>
    </div>
  </div>

  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>Contact</th>
          <th>Subject</th>
          <th>Date</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="messagesTable">
        <tr>
          <td colspan="4" style="text-align:center;padding:40px;color:#666;">
            <i class="fas fa-spinner fa-spin" style="font-size:24px"></i>
            <p>Loading messages...</p>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <div id="mobileCards" class="mobile-cards">
    <div class="card" style="text-align:center;padding:30px;">
      <i class="fas fa-spinner fa-spin" style="font-size:24px"></i>
      <p>Loading messages...</p>
    </div>
  </div>
</div>

<script>
(function() {
    if (!window.db) {
        document.querySelector("#messagesTable").innerHTML =
        "<tr><td colspan='4' style='padding:40px;text-align:center;color:red'>Firestore Not Available</td></tr>";
        return;
    }

    const tableBody = document.getElementById("messagesTable");
    const mobileCards = document.getElementById("mobileCards");

    function formatDate(ts){
        try {
            const d = ts.toDate ? ts.toDate() : new Date(ts);
            return d.toLocaleString("en-IN");
        } catch {
            return "-";
        }
    }

    function render(messages){
        if(messages.length === 0){
            tableBody.innerHTML =
              `<tr><td colspan="4" style="padding:40px;text-align:center;color:#777">
                  <i class='fas fa-inbox' style='font-size:40px;color:#ccc'></i>
                  <p>No messages yet</p>
               </td></tr>`;

            mobileCards.innerHTML =
              `<div class='card' style='text-align:center;padding:40px'>
                  <i class='fas fa-inbox' style='font-size:40px;color:#ccc'></i>
                  <p>No messages yet</p>
               </div>`;
            return;
        }

        tableBody.innerHTML = messages.map(msg => `
          <tr>
            <td>
              <div class="user-info">
                <div class="avatar">${msg.name.charAt(0).toUpperCase()}</div>
                <div>
                  <div style="font-weight:600">${msg.name}</div>
                  <div style="font-size:.8rem;color:#666">${msg.email}</div>
                </div>
              </div>
            </td>
            <td>${msg.subject}</td>
            <td>${formatDate(msg.timestamp)}</td>
            <td><span class="status status-${msg.status}">${msg.status}</span></td>
          </tr>
        `).join("");

        mobileCards.innerHTML = messages.map(msg => `
          <div class="card">
            <div class="card-row">
              <div class="user-info">
                <div class="avatar">${msg.name.charAt(0)}</div>
                <div>
                  <div style="font-weight:600">${msg.name}</div>
                  <div style="font-size:.8rem;color:#666">${msg.email}</div>
                </div>
              </div>
              <span class="status status-${msg.status}">${msg.status}</span>
            </div>
            <div style="font-weight:500">${msg.subject}</div>
            <div style="font-size:.8rem;color:#666">${formatDate(msg.timestamp)}</div>
          </div>
        `).join("");
    }

    function loadMessages(){
        window.db.collection("contactSubmissions")
          .orderBy("timestamp", "desc")
          .get()
          .then(ss => {
              const msgs = ss.docs.map(d => ({
                  id: d.id,
                  ...d.data(),
                  timestamp: d.data().timestamp || null
              }));
              render(msgs);
          })
          .catch(err => {
              tableBody.innerHTML =
              `<tr><td colspan="4" style="padding:40px;text-align:center;color:red">${err.message}</td></tr>`;
          });
    }

    loadMessages();
})();
</script>
