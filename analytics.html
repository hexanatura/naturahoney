<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Dashboard - Natura Honey</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-firestore.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-auth.js"></script>
    <style>
        :root {
            --primary: #1a3a27;
            --primary-light: #2d5a3d;
            --secondary: #d4af37;
            --accent: #f8b500;
            --light: #f9f7f0;
            --dark: #1e1e1e;
            --gray: #6c757d;
            --gray-light: #e9ecef;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --info: #3b82f6;
            --border-radius: 12px;
            --box-shadow: 0 4px 20px rgba(0, 0, 0, 0.08);
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: #f8fafc;
            color: var(--dark);
            line-height: 1.6;
        }

        .dashboard-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 32px;
            padding-bottom: 20px;
            border-bottom: 1px solid var(--gray-light);
        }

        .header h1 {
            color: var(--primary);
            font-size: 2rem;
            font-weight: 700;
        }

        .header-actions {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .date-filter {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .date-filter select {
            padding: 10px 16px;
            border: 1px solid var(--gray-light);
            border-radius: 8px;
            background: white;
            font-weight: 500;
            cursor: pointer;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 12px;
            background: white;
            padding: 10px 16px;
            border-radius: 10px;
            box-shadow: var(--box-shadow);
        }

        .user-avatar {
            width: 42px;
            height: 42px;
            border-radius: 50%;
            background: linear-gradient(135deg, var(--primary) 0%, var(--primary-light) 100%);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 24px;
            margin-bottom: 32px;
        }

        .stat-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--box-shadow);
            display: flex;
            align-items: center;
            transition: var(--transition);
            position: relative;
            overflow: hidden;
        }

        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background: var(--primary);
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 64px;
            height: 64px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 16px;
            font-size: 1.6rem;
        }

        .stat-icon.visits {
            background: linear-gradient(135deg, rgba(26, 58, 39, 0.1) 0%, rgba(45, 90, 61, 0.1) 100%);
            color: var(--primary);
        }

        .stat-icon.carts {
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.1) 0%, rgba(248, 181, 0, 0.1) 100%);
            color: var(--secondary);
        }

        .stat-icon.likes {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1) 0%, rgba(220, 38, 38, 0.1) 100%);
            color: var(--danger);
        }

        .stat-icon.accounts {
            background: linear-gradient(135deg, rgba(59, 130, 246, 0.1) 0%, rgba(37, 99, 235, 0.1) 100%);
            color: var(--info);
        }

        .stat-icon.orders {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1) 0%, rgba(5, 150, 105, 0.1) 100%);
            color: var(--success);
        }

        .stat-icon.revenue {
            background: linear-gradient(135deg, rgba(168, 85, 247, 0.1) 0%, rgba(147, 51, 234, 0.1) 100%);
            color: #8b5cf6;
        }

        .stat-info {
            flex: 1;
        }

        .stat-info h3 {
            font-size: 0.9rem;
            color: var(--gray);
            margin-bottom: 8px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 600;
        }

        .stat-info .value {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 8px;
            color: var(--dark);
        }

        .stat-info .description {
            font-size: 0.85rem;
            color: var(--gray);
        }

        /* Data Sections */
        .data-sections {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 24px;
            margin-bottom: 32px;
        }

        .data-section {
            background: white;
            border-radius: var(--border-radius);
            padding: 24px;
            box-shadow: var(--box-shadow);
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 16px;
            border-bottom: 1px solid var(--gray-light);
        }

        .section-header h3 {
            color: var(--primary);
            font-size: 1.3rem;
            font-weight: 600;
        }

        .data-list {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .data-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 16px;
            background: #f8fafc;
            border-radius: 8px;
            transition: var(--transition);
        }

        .data-item:hover {
            background: #f1f5f9;
        }

        .data-item-info {
            flex: 1;
        }

        .data-item-name {
            font-weight: 600;
            color: var(--dark);
            margin-bottom: 4px;
        }

        .data-item-details {
            font-size: 0.85rem;
            color: var(--gray);
        }

        .data-item-value {
            font-weight: 600;
            color: var(--primary);
        }

        /* Footer */
        .footer {
            text-align: center;
            padding: 20px;
            color: var(--gray);
            font-size: 0.9rem;
            border-top: 1px solid var(--gray-light);
            margin-top: 32px;
        }

        /* Loading State */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
            color: var(--gray);
        }

        .loading i {
            font-size: 2rem;
            margin-right: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--gray);
        }

        .empty-state i {
            font-size: 3rem;
            margin-bottom: 16px;
            color: var(--gray-light);
        }

        /* Refresh indicator */
        .refresh-indicator {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--primary);
            color: white;
            padding: 10px 16px;
            border-radius: 8px;
            font-size: 0.85rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            z-index: 100;
            display: flex;
            align-items: center;
            gap: 8px;
            opacity: 0;
            transform: translateY(10px);
            transition: var(--transition);
        }

        .refresh-indicator.show {
            opacity: 1;
            transform: translateY(0);
        }

        @media (max-width: 768px) {
            .data-sections {
                grid-template-columns: 1fr;
            }
            
            .stats-grid {
                grid-template-columns: 1fr;
            }
            
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 16px;
            }

            .header-actions {
                width: 100%;
                justify-content: space-between;
            }
        }
    </style>
</head>
<body>
    <div class="dashboard-container">
        <div class="header">
            <h1>Analytics Dashboard</h1>
            <div class="header-actions">
                <div class="date-filter">
                    <select id="timeRange">
                        <option value="all">All Time</option>
                        <option value="7d">Last 7 Days</option>
                        <option value="30d" selected>Last 30 Days</option>
                        <option value="90d">Last 90 Days</option>
                    </select>
                </div>
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div>
                        <div>Analytics Viewer</div>
                        <small>Public Access</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Stats Grid -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon visits">
                    <i class="fas fa-eye"></i>
                </div>
                <div class="stat-info">
                    <h3>Page Visits</h3>
                    <div class="value" id="visitCount">0</div>
                    <div class="description">Total website visits</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon carts">
                    <i class="fas fa-shopping-cart"></i>
                </div>
                <div class="stat-info">
                    <h3>Cart Added</h3>
                    <div class="value" id="cartCount">0</div>
                    <div class="description">Products added to cart</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon likes">
                    <i class="fas fa-heart"></i>
                </div>
                <div class="stat-info">
                    <h3>Products Liked</h3>
                    <div class="value" id="likeCount">0</div>
                    <div class="description">Total product likes</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon accounts">
                    <i class="fas fa-user-plus"></i>
                </div>
                <div class="stat-info">
                    <h3>Accounts Created</h3>
                    <div class="value" id="accountCount">0</div>
                    <div class="description">User registrations</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon orders">
                    <i class="fas fa-shopping-bag"></i>
                </div>
                <div class="stat-info">
                    <h3>Orders Placed</h3>
                    <div class="value" id="orderCount">0</div>
                    <div class="description">Completed orders</div>
                </div>
            </div>
            <div class="stat-card">
                <div class="stat-icon revenue">
                    <i class="fas fa-rupee-sign"></i>
                </div>
                <div class="stat-info">
                    <h3>Revenue</h3>
                    <div class="value" id="revenueCount">₹0</div>
                    <div class="description">Total revenue generated</div>
                </div>
            </div>
        </div>

        <!-- Data Sections -->
        <div class="data-sections">
            <div class="data-section">
                <div class="section-header">
                    <h3>Recent Orders</h3>
                </div>
                <div id="recentOrders">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Loading orders...</span>
                    </div>
                </div>
            </div>
            <div class="data-section">
                <div class="section-header">
                    <h3>Popular Products</h3>
                </div>
                <div id="popularProducts">
                    <div class="loading">
                        <i class="fas fa-spinner fa-spin"></i>
                        <span>Loading products...</span>
                    </div>
                </div>
            </div>
        </div>

        <div class="footer">
            <p>Natura Honey Analytics Dashboard &copy; 2023 | Data updates in real-time</p>
        </div>
    </div>

    <div class="refresh-indicator" id="refreshIndicator">
        <i class="fas fa-sync-alt"></i>
        <span>Data Updated</span>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyDuF6bdqprddsE871GuOablXPYqXI_HJxc",
            authDomain: "hexahoney-96aed.firebaseapp.com",
            projectId: "hexahoney-96aed",
            storageBucket: "hexahoney-96aed.firebasestorage.app",
            messagingSenderId: "700458850837",
            appId: "1:700458850837:web:0eb4fca98a5f4acc2d0c1c",
            measurementId: "G-MQGKK9709H"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const db = firebase.firestore();

        // Initialize the dashboard
        document.addEventListener('DOMContentLoaded', function() {
            loadAnalyticsData();
            setupEventListeners();
        });

        // Load all analytics data from Firebase
        async function loadAnalyticsData() {
            try {
                console.log("Loading analytics data from Firebase...");
                
                // Load all data in parallel
                await Promise.all([
                    loadPageVisits(),
                    loadCartData(),
                    loadLikesData(),
                    loadAccountsData(),
                    loadOrdersData(),
                    loadRevenueData(),
                    loadRecentOrders(),
                    loadPopularProducts()
                ]);
                
                showRefreshIndicator();
                
            } catch (error) {
                console.error("Error loading analytics data:", error);
                showErrorState();
            }
        }

        // Load page visits data
        async function loadPageVisits() {
            try {
                // Get from localStorage (tracked from main site)
                const pageVisits = localStorage.getItem('naturaPageVisits');
                const count = pageVisits ? parseInt(pageVisits) : 0;
                document.getElementById('visitCount').textContent = count.toLocaleString();
                console.log("Page visits:", count);
            } catch (error) {
                console.error("Error loading page visits:", error);
                document.getElementById('visitCount').textContent = "0";
            }
        }

        // Load cart data
        async function loadCartData() {
            try {
                let totalCartItems = 0;
                
                // Get guest cart from localStorage
                const guestCart = localStorage.getItem('guestCart');
                if (guestCart) {
                    const cartItems = JSON.parse(guestCart);
                    totalCartItems = cartItems.reduce((total, item) => total + item.quantity, 0);
                }
                
                // Get user carts from Firestore
                const cartsSnapshot = await db.collection('carts').get();
                cartsSnapshot.forEach(doc => {
                    const cart = doc.data();
                    if (cart.items && Array.isArray(cart.items)) {
                        totalCartItems += cart.items.reduce((total, item) => total + item.quantity, 0);
                    }
                });
                
                document.getElementById('cartCount').textContent = totalCartItems.toLocaleString();
                console.log("Cart items:", totalCartItems);
            } catch (error) {
                console.error("Error loading cart data:", error);
                document.getElementById('cartCount').textContent = "0";
            }
        }

        // Load likes data
        async function loadLikesData() {
            try {
                let totalLikes = 0;
                
                // Get guest likes from localStorage
                const guestLikes = localStorage.getItem('guestLikes');
                if (guestLikes) {
                    const likedProducts = JSON.parse(guestLikes);
                    totalLikes = likedProducts.length;
                }
                
                // Get user likes from Firestore
                const likesSnapshot = await db.collection('likes').get();
                totalLikes += likesSnapshot.size;
                
                document.getElementById('likeCount').textContent = totalLikes.toLocaleString();
                console.log("Total likes:", totalLikes);
            } catch (error) {
                console.error("Error loading likes data:", error);
                document.getElementById('likeCount').textContent = "0";
            }
        }

        // Load accounts data
        async function loadAccountsData() {
            try {
                const usersSnapshot = await db.collection('users').get();
                const userCount = usersSnapshot.size;
                
                document.getElementById('accountCount').textContent = userCount.toLocaleString();
                console.log("User accounts:", userCount);
            } catch (error) {
                console.error("Error loading accounts data:", error);
                document.getElementById('accountCount').textContent = "0";
            }
        }

        // Load orders data
        async function loadOrdersData() {
            try {
                const ordersSnapshot = await db.collection('orders').get();
                const orderCount = ordersSnapshot.size;
                
                document.getElementById('orderCount').textContent = orderCount.toLocaleString();
                console.log("Total orders:", orderCount);
            } catch (error) {
                console.error("Error loading orders data:", error);
                document.getElementById('orderCount').textContent = "0";
            }
        }

        // Load revenue data
        async function loadRevenueData() {
            try {
                let totalRevenue = 0;
                const ordersSnapshot = await db.collection('orders').get();
                
                ordersSnapshot.forEach(doc => {
                    const order = doc.data();
                    if (order.total && typeof order.total === 'number') {
                        totalRevenue += order.total;
                    }
                });
                
                document.getElementById('revenueCount').textContent = '₹' + totalRevenue.toLocaleString();
                console.log("Total revenue:", totalRevenue);
            } catch (error) {
                console.error("Error loading revenue data:", error);
                document.getElementById('revenueCount').textContent = "₹0";
            }
        }

        // Load recent orders
        async function loadRecentOrders() {
            try {
                const ordersSnapshot = await db.collection('orders')
                    .orderBy('createdAt', 'desc')
                    .limit(10)
                    .get();
                
                const ordersContainer = document.getElementById('recentOrders');
                ordersContainer.innerHTML = '';
                
                if (ordersSnapshot.empty) {
                    ordersContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-shopping-bag"></i>
                            <p>No orders found</p>
                        </div>
                    `;
                    return;
                }
                
                const ordersList = document.createElement('div');
                ordersList.className = 'data-list';
                
                ordersSnapshot.forEach(doc => {
                    const order = doc.data();
                    const orderItem = document.createElement('div');
                    orderItem.className = 'data-item';
                    
                    const customerName = order.shippingAddress ? 
                        `${order.shippingAddress.firstName} ${order.shippingAddress.lastName}` : 
                        'Guest Customer';
                    
                    const orderDate = order.createdAt ? 
                        new Date(order.createdAt.seconds * 1000).toLocaleDateString() : 
                        'Unknown Date';
                    
                    orderItem.innerHTML = `
                        <div class="data-item-info">
                            <div class="data-item-name">Order #${doc.id.substring(0, 8)}</div>
                            <div class="data-item-details">${customerName} • ${orderDate}</div>
                        </div>
                        <div class="data-item-value">₹${order.total || 0}</div>
                    `;
                    
                    ordersList.appendChild(orderItem);
                });
                
                ordersContainer.appendChild(ordersList);
                
            } catch (error) {
                console.error("Error loading recent orders:", error);
                document.getElementById('recentOrders').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>Error loading orders</p>
                    </div>
                `;
            }
        }

        // Load popular products
        async function loadPopularProducts() {
            try {
                // Get your products array
                const products = [
                    { id: 1, name: "Natura Agmark Honey", weight: "1Kg", price: 249, category: "crystal" },
                    { id: 2, name: "Natura Agmark Honey", weight: "500g", price: 449, category: "crystal" },
                    { id: 3, name: "Natura Agmark Honey", weight: "100g", price: 149, category: "crystal" },
                    { id: 4, name: "Natura Agmark Honey", weight: "50g", price: 349, category: "crystal" },
                    { id: 5, name: "Natura Agmark Honey", weight: "1Kg", price: 199, category: "premium" },
                    { id: 6, name: "Natura Agmark Honey - Premium Pet", weight: "500g", price: 329, category: "premium" }
                ];
                
                // Get likes data
                const productLikes = {};
                const guestLikes = JSON.parse(localStorage.getItem('guestLikes') || '[]');
                guestLikes.forEach(productId => {
                    productLikes[productId] = (productLikes[productId] || 0) + 1;
                });
                
                // Get sales data from orders
                const productSales = {};
                const ordersSnapshot = await db.collection('orders').get();
                ordersSnapshot.forEach(doc => {
                    const order = doc.data();
                    if (order.items && Array.isArray(order.items)) {
                        order.items.forEach(item => {
                            productSales[item.productId] = (productSales[item.productId] || 0) + item.quantity;
                        });
                    }
                });
                
                // Create product list with actual data
                const productList = products.map(product => {
                    return {
                        id: product.id,
                        name: `${product.name} - ${product.weight}`,
                        category: product.category,
                        price: product.price,
                        likes: productLikes[product.id] || 0,
                        sales: productSales[product.id] || 0
                    };
                }).sort((a, b) => b.sales - a.sales).slice(0, 10);
                
                const productsContainer = document.getElementById('popularProducts');
                productsContainer.innerHTML = '';
                
                if (productList.length === 0) {
                    productsContainer.innerHTML = `
                        <div class="empty-state">
                            <i class="fas fa-box"></i>
                            <p>No product data available</p>
                        </div>
                    `;
                    return;
                }
                
                const productsList = document.createElement('div');
                productsList.className = 'data-list';
                
                productList.forEach(product => {
                    const productItem = document.createElement('div');
                    productItem.className = 'data-item';
                    
                    productItem.innerHTML = `
                        <div class="data-item-info">
                            <div class="data-item-name">${product.name}</div>
                            <div class="data-item-details">${product.category} • ₹${product.price} • ${product.likes} likes</div>
                        </div>
                        <div class="data-item-value">${product.sales} sold</div>
                    `;
                    
                    productsList.appendChild(productItem);
                });
                
                productsContainer.appendChild(productsList);
                
            } catch (error) {
                console.error("Error loading popular products:", error);
                document.getElementById('popularProducts').innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-exclamation-circle"></i>
                        <p>Error loading products</p>
                    </div>
                `;
            }
        }

        // Show refresh indicator
        function showRefreshIndicator() {
            const indicator = document.getElementById('refreshIndicator');
            indicator.classList.add('show');
            
            setTimeout(() => {
                indicator.classList.remove('show');
            }, 3000);
        }

        // Show error state
        function showErrorState() {
            const statsGrid = document.querySelector('.stats-grid');
            statsGrid.innerHTML = `
                <div class="empty-state" style="grid-column: 1 / -1;">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Unable to Load Data</h3>
                    <p>Please check your Firebase configuration and try again.</p>
                    <button onclick="loadAnalyticsData()" style="margin-top: 16px; padding: 10px 20px; background: var(--primary); color: white; border: none; border-radius: 6px; cursor: pointer;">Retry</button>
                </div>
            `;
        }

        // Setup event listeners
        function setupEventListeners() {
            // Handle time range change
            document.getElementById('timeRange').addEventListener('change', function() {
                loadAnalyticsData();
            });
            
            // Refresh data every 2 minutes
            setInterval(loadAnalyticsData, 120000);
        }
    </script>
</body>
</html>
